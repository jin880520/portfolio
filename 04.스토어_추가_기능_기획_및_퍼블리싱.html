<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>스토어</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
    :root{--cb-text:#223046;--cb-sub:#6c7a89;--cb-line:#e8edf3;--cb-card:#ffffff;--cb-bg:#f6f8fb;--accent:#2b63f1;--ok:#16a34a;--warn:#f59e0b;--danger:#b91c1c;--shadow:0 8px 24px rgba(51,65,85,.08);--round:16px}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--cb-bg);color:var(--cb-text);font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:36px auto 0;padding:0 16px;padding-bottom:calc(80px + env(safe-area-inset-bottom))}
    .page-head{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:14px}
    .title{font-size:22px;font-weight:900}
    .sub{color:var(--cb-sub);font-size:14px}
    .grid{display:grid;gap:14px}
    .g2{grid-template-columns:1fr 1fr}
    .card{background:var(--cb-card);border:1px solid var(--cb-line);border-radius:var(--round);box-shadow:var(--shadow);padding:16px;margin-bottom:16px}
    .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .head .ttl{font-weight:900}
    .hint{color:var(--cb-sub);font-size:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--cb-line);background:#fff;padding:8px 12px;border-radius:999px;font-weight:800}
    .pill i{color:var(--accent)}
    .badge{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 8px;font-size:12px;font-weight:800;border:1px solid #e3e9ff;background:#eef3ff;color:#2b63f1}
    .flag{display:inline-flex;align-items:center;gap:6px;background:#fff7ed;border:1px solid #ffe5c2;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:800;color:#9a5b00;margin:10px 0}
    .tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--cb-line);border-radius:999px;padding:2px 8px;font-size:11px;background:#fff;color:#475569}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .btn{border:1px solid var(--cb-line);background:#fff;border-radius:12px;padding:10px 12px;display:inline-flex;align-items:center;gap:8px;font-weight:800;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .btn:active{transform:translateY(1px)}
    .links{margin-top:10px;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .link{display:flex;align-items:center;gap:8px;border:1px solid var(--cb-line);border-radius:12px;padding:10px 12px;background:#fff;font-weight:800}
    .link .code{font-size:12px;color:#475569;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:6px;padding:2px 6px}
    .link .go{margin-left:auto;color:#64748b}
    .tree{border:1px dashed var(--cb-line);border-radius:12px;padding:12px;font-size:14px;line-height:1.6;background:#fafcff}
    .tree .root{font-weight:900;margin-bottom:6px}
    .tree ul{list-style:none;margin:0;padding-left:16px}
    .tree li{margin:2px 0}
    .kv{display:grid;grid-template-columns:180px 1fr;gap:10px;padding:8px 0;border-bottom:1px dashed var(--cb-line)}
    .kv:last-child{border-bottom:0}
    h2{font-size:18px;margin:6px 0 10px}
    h3{font-size:16px;margin:14px 0 8px}
    details{border:1px solid var(--cb-line);border-radius:12px;background:#f8fcff}
    details+details{margin-top:10px}
    details>summary{cursor:pointer;padding:12px 14px;font-weight:900}
    details .inner{padding:0 14px 12px}
    ul.tight>li{margin:2px 0}
    .list{list-style:disc;padding-left:18px;margin:6px 0}
    .note{background:#f8fafc;border:1px solid var(--cb-line);border-radius:12px;padding:10px;font-size:12px;color:#475569}
    .foot{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    .list-legend{display:flex;gap:8px;flex-wrap:wrap}
    .k{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--cb-line);background:#fff;border-radius:999px;padding:4px 8px;font-size:12px}
    .k i{color:#64748b}
    .mt8{margin-top:8px}
    .mt12{margin-top:12px}
    .fold { border:0; background:transparent; }
    .fold > summary {
        display:flex; align-items:center; gap:8px;
        padding:10px 12px; margin:-6px -6px 8px;
        border:1px solid var(--cb-line); border-radius:12px;
        background:#f8fbff; font-weight:900; cursor:pointer;
    }
    .fold[open] > summary { background:#eef3ff; border-color:#dfe7ff; }
    .fold-body { padding:0; }
    .fold > summary i { color:#2b63f1; }
    @media (max-width:960px){.g2{grid-template-columns:1fr}}
    @media (max-width:720px){.wrap{margin:20px auto 0;padding:0 12px;padding-bottom:calc(64px + env(safe-area-inset-bottom))}.page-head{flex-direction:column;align-items:flex-start;gap:6px;margin-bottom:10px}.title{font-size:20px}.sub{font-size:13px}.card{padding:14px}.links{grid-template-columns:1fr}.link{padding:12px 14px}.kv{grid-template-columns:1fr;gap:6px}.kv>div:first-child{font-weight:700;color:#334155}.tree{padding:10px}.note{font-size:11.5px}.btn{width:100%;justify-content:center;padding:12px 14px}.chips{gap:8px}}
    @media (max-width:520px){h2{font-size:17px}h3{font-size:15px}.pill{padding:6px 10px}details>summary{padding:10px 12px}details .inner{padding:0 12px 10px}.list{padding-left:16px}}
    @media (prefers-reduced-motion:reduce){.btn:active{transform:none}}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="page-head">
            <div>
                <div class="title"><i class="fa-solid fa-sitemap"></i> 인덱스</div>
                <div class="sub">관리자·유저 페이지 구조와 바로가기 모음</div>
            </div>
            <div class="quick">
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="head">
                    <div class="ttl"><i class="fa-solid fa-user-gear"></i> 관리자 영역</div>
                    <div class="badge">메인/서브 관리자</div>
                </div>
                <div class="tree">
                    <div class="root">스토어 관리</div>
                    <ul>
                        <li>스토어 설정</li>
                        <li>매출 통계</li>
                        <li>카테고리 관리
                            <ul>
                                <li>카테고리 등록, 수정</li>
                            </ul>
                        </li>
                        <li>상품 관리
                            <ul>
                                <li>상품 등록, 수정</li>
                            </ul>
                        </li>
                        <li>주문/결제 관리
                            <ul>
                                <li>배송지, 배송정보 입력</li>
                            </ul>
                        </li>
                        <li>장바구니</li>
                        <li>쿠폰 발행</li>
                    </ul>
                </div>
                <div class="links">
                    <a class="link" href="store/01_01.html" target="_blank"><span class="code">01_01</span><span>스토어 설정</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/01_02.html" target="_blank"><span class="code">01_02</span><span>매출 통계</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/01_03.html" target="_blank"><span class="code">01_03</span><span>카테고리 관리</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/01_04.html" target="_blank"><span class="code">01_04</span><span>상품 관리</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/01_05.html" target="_blank"><span class="code">01_05</span><span>주문/결제 관리</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/01_06.html" target="_blank"><span class="code">01_06</span><span>장바구니</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/01_07.html" target="_blank"><span class="code">01_07</span><span>쿠폰 발행</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                </div>
                <div class="foot">
                </div>
            </div>

            <div class="card">
                <div class="head">
                    <div class="ttl"><i class="fa-solid fa-users"></i> 유저 영역</div>
                    <div class="badge">스토어</div>
                </div>
                <div class="tree">
                    <div class="root">쇼핑 페이지</div>
                    <ul>
                        <li>상품 (쇼핑 - 관리자 설정에 때라 메뉴명 변경)
                            <ul>
                                <li>상품 상세
                                    <ul>
                                        <li>결제</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>장바구니</li>
                        <li>주문/결제</li>
                        <li>쿠폰</li>
                    </ul>
                </div>
                <div class="links">
                    <a class="link" href="store/02_01.html" target="_blank"><span class="code">02_01</span><span>상품 (쇼핑 - 관리자 설정에 때라 메뉴명 변경)</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/02_01_01.html" target="_blank"><span class="code">02_01_01</span><span>상품 상세</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/02_01_02.html" target="_blank"><span class="code">02_01_02</span><span>주문/결제</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/02_02.html" target="_blank"><span class="code">02_02</span><span>장바구니</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/02_03.html" target="_blank"><span class="code">02_03</span><span>주문/결제 내역</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                    <a class="link" href="store/02_04.html" target="_blank"><span class="code">02_04</span><span>쿠폰</span><span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span></a>
                </div>
            </div>
        </div>
        
        <div class="page-head" style="margin-top: 50px;">
            <div>
                <div class="title"><i class="fa-solid fa-sitemap"></i> 스토어 기능 기획서</div>
            </div>
            <div class="quick">
                <button class="btn" id="btnOpenAll">
                    <i class="fa-solid fa-folder-open"></i> 모두 열기
                </button>
                <button class="btn" id="btnCloseAll">
                    <i class="fa-solid fa-folder-closed"></i> 모두 접기
                </button>
            </div>
        </div>

        <style>
            html { scroll-behavior: smooth; }
            .toc {
                margin: 10px 0 18px;
                background: #fff;
                border: 1px solid #e8edf3;
                border-radius: 12px;
                box-shadow: 0 8px 24px rgba(51,65,85,.06);
                padding: 12px;
            }
            .toc .toc-title { font-weight: 900; margin: 0 0 8px; font-size: 14px; color:#223046; }
            .toc ol {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 6px 12px;
                list-style: none;
                margin: 0;
                padding: 0;
                counter-reset: toc;
                font-size: 14px;
            }
            .toc a {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 10px;
                border: 1px solid #e8edf3;
                border-radius: 10px;
                background: #f8fbff;
                color: #223046;
                text-decoration: none;
                font-weight: 800;
                transition: background .15s, border-color .15s;
                white-space: nowrap;
            }
            .toc a:hover { background:#eef3ff; border-color:#dfe7ff; }
            .toc a .n {
                display:inline-flex;min-width:22px;height:22px;align-items:center;justify-content:center;
                border-radius:999px;background:#eef3ff;color:#2b63f1;border:1px solid #dfe7ff;font-size:12px;
                font-weight:900;
            }
            .toc a.active { outline: 2px solid #2b63f1; background:#eef3ff; }
            @media (max-width: 860px) { .toc ol { grid-template-columns: repeat(2, 1fr); } }
            @media (max-width: 560px) { .toc ol { grid-template-columns: 1fr; } }
        </style>

        <nav class="toc" aria-label="스토어 문서 목차">
            <div class="toc-title">목차</div>
            <ol>
                <li><a href="#sec-0"><span class="n">0</span> 화면 퍼블리싱 진행/제외</a></li>
                <li><a href="#sec-1"><span class="n">1</span> 범위 및 원칙</a></li>
                <li><a href="#sec-2"><span class="n">2</span> 권한·노출 규칙</a></li>
                <li><a href="#sec-3"><span class="n">3</span> 데이터 모델</a></li>
                <li><a href="#sec-4"><span class="n">4</span> 라우팅 구조</a></li>
                <li><a href="#sec-5"><span class="n">5</span> 페이지별 상세 요건</a></li>
                <li><a href="#sec-6"><span class="n">6</span> 결제/주문 플로우</a></li>
                <li><a href="#sec-7"><span class="n">7</span> 보안/검증</a></li>
                <li><a href="#sec-8"><span class="n">8</span> 로깅·통계</a></li>
                <li><a href="#sec-9"><span class="n">9</span> 마이그레이션 & 적용</a></li>
                <li><a href="#store-admin-todo"><span class="n">10</span> 추가 작업(관리자별 스토어 허용)</a></li>
            </ol>
        </nav>

        <script>
            // 섹션 위치에 따라 목차 강조 (id가 없으면 아래 주석 참고해 id 추가)
            (function () {
                const map = [
                    "#sec-0","#sec-1","#sec-2","#sec-3","#sec-4",
                    "#sec-5","#sec-6","#sec-7","#sec-8","#sec-9","#store-admin-todo"
                ].map(s => document.querySelector(s)).filter(Boolean);
                const links = Array.from(document.querySelectorAll('.toc a'));
                if (!map.length) return;

                const byId = Object.fromEntries(links.map(a => [a.getAttribute('href').replace(location.origin, ''), a]));
                const obs = new IntersectionObserver((entries) => {
                    entries.forEach(e => {
                        const id = "#" + e.target.id;
                        const link = byId[id];
                        if (!link) return;
                        if (e.isIntersecting) {
                            links.forEach(l => l.classList.remove('active'));
                            link.classList.add('active');
                        }
                    });
                }, { rootMargin: "-40% 0px -50% 0px", threshold: 0.01 });

                map.forEach(sec => obs.observe(sec));
            })();
        </script>

        <!-- 퍼블리싱 완료/제외 안내 (비개발자용) -->
        <section class="card" id="sec-0">
            <details class="fold">
                <summary><i class="fa-solid fa-folder-minus"></i> 0) 화면 퍼블리싱 진행 상황 및 이번 문서에서 다루지 않는 것</summary>
                    <div class="fold-body">
                      <div class="note">
                        이 문서는 <b>기능과 연결 방식(어떻게 동작하게 할지)</b>에 초점을 맞춥니다.<br/>
                        이미 <u>완성된 화면(퍼블리싱) 13페이지</u>가 있기 때문에
                        <b>화면의 모양(레이아웃·글꼴·버튼 스타일 등) 자체를 바꾸는 기획은 이번 문서에서 다루지 않습니다.</b><br/>
                        <b>※ 퍼블리싱된 화면 목록과 바로가기는 위쪽 <u>인덱스(링크 허브)</u>와 <u>5) 페이지별 상세 요건 (13개 · 세분화)</u>에서 확인하세요.</b>
                      </div>
                      <h3>0.1 완성된 화면 범위</h3>
                      <ul class="list">
                        <li>관리자용 7개 페이지(01_01~01_07)와 이용자용 6개 페이지(02_01~02_04)까지 <b>총 13개 페이지</b>가 완료되었습니다.</li>
                        <li>공통 요소(카드형 박스, 목록, 배지/태그, 링크 카드, 정보 행, 트리, 알림 상자 등)가 통일된 디자인으로 적용되어 있습니다.</li>
                        <li>모바일 대응 완료: 화면 폭이 줄어들면 자동으로 2열 → 1열로 바뀌고 글자 크기 및 여백이 모바일에 맞게 조정됩니다.</li>
                        <li><b>각 페이지의 데모는 상단 인덱스의 링크를 통해 바로 확인</b>할 수 있습니다.</li>
                      </ul>
                      <h3>0.2 이번 문서에서 다루는 것과 다루지 않는 것</h3>
                      <ul class="list">
                        <li><b>다루는 것</b>: 메뉴 권한과 노출 기준, 필요한 데이터 구조, 화면과 서버 연결 경로, 결제/주문 흐름, 보안 확인 항목, 통계 보기, 적용 단계(마이그레이션)</li>
                        <li><b>다루지 않는 것</b>: 색상/여백/글꼴 크기 변경, 새로운 디자인 요소 추가, 모바일 레이아웃 재설계, 애니메이션 등 시각 효과 추가</li>
                      </ul>
                      <h3>0.3 연동 시 유의 사항(개발 전달 전제)</h3>
                      <ul class="list">
                        <li>현재 화면의 구성은 그대로 사용하고, <b>버튼·입력칸 등 기능만 실제 데이터와 연결</b>합니다.</li>
                        <li>가격 합계·쿠폰·배송비 계산은 화면에서 미리 보여주더라도, <b>최종 금액은 서버에서 한 번 더 정확히 확인</b>합니다.</li>
                        <li>아이콘은 문서 상단에 포함된 <b>Font Awesome</b>을 사용합니다.</li>
                        <li>지원 환경: 최신 크롬/엣지/사파리, iOS/안드로이드 최신 2개 버전을 우선 지원합니다.</li>
                      </ul>
                    </div>
            </details>
        </section>

        <!-- 1. 범위/원칙 -->
        <section class="card" id="sec-1">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 1) 범위 및 원칙</summary>
              <div class="fold-body">
                <ul class="list">
                    <li>스토어는 각 관리자 사이트에 추가 기능 형식으로 적용</li>
                    <li><b>메인 관리자</b>도 스토어 전 메뉴(01_01~01_07)를 사용 가능 <b>서브 관리자</b>는 <b>메인 관리자가</b> 허용 시 노출/사용</li>
                    <li>결제는 <b>단건 결제</b>만 지원 <b>(기존 챗봇 구독 결제 부분의 일반 결제 기능만 별로도 스토어 결제로 추가 개발)</b></li>
                    <li><b>스토어 설정(01_01)</b>에서 <u>서브 관리자별 Toss Pay 키</u>를 등록하여 각 서브 관리자의 결제 시스템을 분리</li>
                </ul>
                <div class="note"><b>네비 기준</b> : 01_01~01_07(관리자) · 02_01, 02_01_01, 02_01_02, 02_02, 02_03, 02_04(유저) = 총 13페이지</div>
              </div>
            </details>
        </section>

        <!-- 2. 권한/노출 -->
        <section class="card" id="sec-2">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 2) 권한·노출 규칙</summary>
              <div class="fold-body">
                <div class="kv"><div>관리자 메뉴</div><div>메인 관리자: 항상 노출/사용<br>서브 관리자: 메인 관리자의 스토어 허용 시 노출/사용</div></div>
                <div class="kv"><div>유저 메뉴</div><div>해당 사이트가 스토어 기능 활성 일경우 사이드 메뉴 노출</div></div>
                <div class="kv"><div>결제키</div><div>스토어 기능이 활성화 되어 있더라도 결제키 정보가 없을경우 결제 시 구매 불가능 안내</div></div>
              </div>
            </details>
        </section>

        <!-- 3. 데이터 모델 -->
        <section class="card" id="sec-3">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 3) 데이터 모델 (요약 · 퍼블리싱 13페이지 및 기존 챗봇 소스 반영)</summary>
              <div class="fold-body">
                <div class="grid g2">
                    <div>
                        <h3>3.1 스토어/권한/결제키</h3>
                        <ul class="tight">
                            <li><b>AcStoreFeatureToggle</b>(site_id, sub_manager_uid, enabled)
                                <br>· 메인 관리자가 서브 사이트별 스토어 사용 허용 여부를 제어(인덱스 및 좌측 메뉴 노출 조건)</li>
                            <li><b>AcStoreSetting</b>(site_id, shop_name, contact, notice, refund_policy, shipping_policy, currency, tax_mode, is_published)
                                <br>· 01_01 화면의 상점 기본설정/정책 영역을 저장</li>
                            <li><b>AcStorePaymentConfig</b>(site_id, sub_manager_uid, mode['test'|'live'], toss_client_key, toss_secret_key, webhook_secret, updated_at)
                                <br>· 01_01 "서브별 결제키" 표. 결제 시 (site_id, sub_manager_uid)로 조회하여 <u>서브별 결제 분리</u>
                                <br>· 기존 챗봇 소스(app/utils/toss_config.py)의 전역 키 사용과 달리, <u>스토어 전용 개별 키</u>를 사용</li>
                        </ul>
                    </div>
                    <div>
                        <h3>3.2 상점 엔티티</h3>
                        <ul class="tight">
                            <li><b>AcStoreCategory</b>(site_id, name, parent_id, sort, is_active)
                                <br>· 01_03 트리/정렬, 활성 토글 반영</li>
                            <li><b>AcStoreProduct</b>(site_id, category_id, title, desc, price, stock, sku, is_active, is_hidden, badge, created_at)
                                <br>· 01_04의 "재고/SKU", "숨김" 등 UI 필드 반영</li>
                            <li><b>AcStoreProductImage</b>(product_id, url, sort, is_primary)</li>
                            <li><b>AcStoreCart</b>(site_id, member_uid_or_session, status['active'|'converted'|'abandoned'], updated_at)
                                <br>· 01_06의 장바구니 현황/방치 통계를 위한 상태값 포함</li>
                            <li><b>AcStoreCartItem</b>(cart_id, product_id, title_snapshot, qty, unit_price, subtotal, coupon_id)</li>
                            <li><b>AcStoreCoupon</b>(site_id, code, type['amount'|'percent'|'free_shipping'], value, min_amount, valid_from, valid_to, scope['all'|'category'|'product'], scope_ref, per_user_limit, max_use, is_active)
                                <br>· 01_07의 유형/제약/범위 UI 반영</li>
                            <li><b>AcStoreOrder</b>(site_id, member_uid, order_no, status['pay_wait'|'paid'|'canceled'|'refunded'], method, total_items, items_amount, discount_amount, shipping_fee, payment_amount, receipt_url, payment_key, shipping_name, shipping_phone, shipping_zip, shipping_addr1, shipping_addr2, memo, created_at)
                                <br>· 01_05/02_03 화면의 상태, 금액 요약, 배송지/메모 반영</li>
                            <li><b>AcStoreOrderItem</b>(order_id, product_id, title_snapshot, sku, qty, unit_price, subtotal)</li>
                        </ul>
                    </div>
                </div>
                <div class="note">
                    정기결제/구독 관련 칼럼 및 스케줄러는 생성하지 않습니다(스토어 모듈은 <u>단건 결제</u> 전용)
                </div>
              </div>
            </details>
        </section>

        <!-- 4. 라우팅 -->
        <section class="card" id="sec-4">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 4) 라우팅 구조 (퍼블리싱 13페이지 기준 · 실제 서비스 연결)</summary>
              <div class="fold-body">
                <div class="note">
                    · 본 라우팅은 기준안이며, 실제 적용 시 프레임워크·인프라 환경에 맞춰 조정될 수 있습니다.<br>
                    · 아래 라우트는 예시 스펙입니다. 구현 환경/정책에 따라 경로·파라미터가 변경될 수 있습니다.<br>
                    · 라우팅은 서비스 아키텍처와 배포 방식에 따라 변동 가능(필요 시 버전닝·리다이렉트 적용).<br>
                    · 실제 운영 반영 시 팀 내 규칙(API 버전, 인증, 네이밍)에 맞게 수정·확정합니다.<br>
                    · 개발 진행 과정에서 세부 경로·메서드는 협의 후 업데이트됩니다.<br>
                </div>
                <div class="grid g2">
                    <div>
                        <h3>관리자(Admin)</h3>
                        <ul class="mono">
                            <li>GET /admin/store/settings?site_id=… · POST /admin/store/settings
                                <br>· 01_01 스토어 설정(상점 기본/정책/서브별 Toss 키)</li>
                            <li>POST /admin/store/payment-config/store
                                <br>· 01_01 "키 유효성 검사" 버튼</li>

                            <li>GET /admin/store/stats?site_id=…&from=YYYY-MM-DD&to=YYYY-MM-DD&granularity=daily|monthly|hourly
                                <br>· 01_02 매출 통계(기간/사이트/단위 필터 반영)</li>
                            <li>GET /admin/store/stats/export.csv?site_id=…&from=…&to=…&granularity=…
                                <br>· 01_02 CSV 내보내기</li>

                            <li>GET /admin/store/categories · POST /admin/store/categories · PUT /admin/store/categories/:id · DELETE /admin/store/categories/:id
                                <br>· 01_03 카테고리 목록/등록/수정/삭제</li>

                            <li>GET /admin/store/products?site_id=…&q=…&status=active|hidden|soldout|archived&category_id=…
                                <br>· 01_04 상품 목록/검색/필터</li>
                            <li>POST /admin/store/products · PUT /admin/store/products/:id
                                <br>· 01_04 상품 등록/수정</li>
                            <li>POST /admin/store/products/:id/images
                                <br>· 01_04 이미지 업로드/정렬</li>

                            <li>GET /admin/store/orders?site_id=…&status=pay_wait|paid|refund|cancel&from=…&to=…
                                <br>· 01_05 주문 리스트/필터</li>
                            <li>GET /admin/store/orders/:id
                                <br>· 01_05 주문 상세(주소/배송/결제 로그)</li>
                            <li>POST /admin/store/orders/:id/cancel · POST /admin/store/orders/:id/refund
                                <br>· 01_05 취소/환불(정책 허용 시)</li>

                            <li>GET /admin/store/carts?site_id=…&sort=recent|amount|qty&q=…&from=…&to=…
                                <br>· 01_06 장바구니 조회/정렬/검색</li>

                            <li>GET /admin/store/coupons?site_id=… · POST /admin/store/coupons · PUT /admin/store/coupons/:id · DELETE /admin/store/coupons/:id
                                <br>· 01_07 쿠폰 발행/수정/삭제</li>
                        </ul>
                    </div>

                    <div>
                        <h3>유저(Member)</h3>
                        <ul class="mono">
                            <!-- 페이지 (View) -->
                            <li>GET /member/store/
                                <span>· 02_01 스토어 홈/상품 리스트</span></li>
                            <li>GET /member/store/products/{slug}
                                <span>· 02_01_01 상품 상세</span></li>
                            <li>GET /member/store/cart
                                <span>· 02_02 장바구니</span></li>
                            <li>GET /member/store/checkout
                                <span>· 02_01_02 주문/결제(체크아웃)</span></li>
                            <li>GET /member/store/orders
                                <span>· 02_03 주문/결제 내역</span></li>
                            <li>GET /member/store/coupons
                                <span>· 02_04 보유 쿠폰</span></li>

                            <!-- API (실서비스) -->
                            <li>GET    /api/member/products?q=…&category_id=…&sort=…&page=1&size=12
                                <span>· 상품 리스트 데이터</span></li>
                            <li>GET    /api/member/products/{slug}
                                <span>· 상품 상세 데이터</span></li>

                            <li>GET    /api/member/carts/current
                                <span>· 장바구니 조회</span></li>
                            <li>POST   /api/member/carts { product_id, qty, options? }
                                <span>· 장바구니 담기</span></li>
                            <li>PATCH  /api/member/carts/lines/:id { qty }
                                <span>· 수량 변경</span></li>
                            <li>DELETE /api/member/carts/lines
                                <span>· 선택 라인 삭제</span></li>
                            <li>DELETE /api/member/carts
                                <span>· 전체 비우기</span></li>
                            <li>POST   /api/member/carts/coupon { code|id, action:apply|remove }
                                <span>· 장바구니 쿠폰 적용/해제</span></li>

                            <li>POST   /api/member/checkout
                                <span>· 결제 Intent 생성(스토어 설정의 실/테스트 키 사용)</span></li>
                            <li>POST   /api/member/orders/confirm
                                <span>· 결제 성공 콜백 검증 및 주문 확정(status=paid)</span></li>

                            <li>GET    /api/member/orders?from=…&to=…&status=…&q=…&page=1&size=10
                                <span>· 주문 목록</span></li>
                            <li>GET    /api/member/orders/:order_id
                                <span>· 주문 상세</span></li>
                            <li>POST   /api/member/orders/:order_id/cancel
                                <span>· 주문취소 요청(정책 범위)</span></li>
                            <li>POST   /api/member/orders/:order_id/return
                                <span>· 반품/교환 요청</span></li>

                            <li>GET    /api/member/coupons
                                <span>· 보유 쿠폰 목록/상태</span></li>
                            <li>POST   /api/member/coupons/redeem { code }
                                <span>· 코드 등록</span></li>
                            <li>POST   /api/member/coupons/preview { coupon_id, subtotal }
                                <span>· 할인 미리보기</span></li>
                        </ul>
                    </div>
                </div>
                <div class="note">
                    · 관리자 화면은 상단의 <u>사이트 선택(메인 전용)</u>과 기간/단위 필터(01_02)를 공통으로 반영합니다.<br>
                    · 스토어 메뉴 노출은 <u>store_enabled</u> 설정에 따르며, 페이지/사이드 메뉴 규칙과 일치합니다.
                </div>
              </div>
            </details>   
        </section>

        <!-- 5. 페이지별 상세 (13개) -->
        <section class="card" id="sec-5">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 5) 페이지별 상세 요건 (13개 · 세분화)</summary>
              <div class="fold-body">

                <!-- ADMIN 01_01 -->
                <details>
                    <summary>01_01 · 스토어 설정 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_01.html" target="_blank"><span class="code">01_01</span> <span>스토어 설정</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET/POST /admin/store/settings</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                사이트별 스토어 기본값과 고지 문구, <b>스토어 온/오프</b>, <b>결제 모드(실/테스트)</b>, <b>토스 키</b>, <b>배송사/도서산간 안내</b>를 설정합니다.<br>
                                (상단 <u>사이트 선택</u>은 메인 관리자만)
                            </div>
                        </div>

                        <h3>폼 필드</h3>
                        <ul class="list">
                            <li><b>사이트 선택</b> : <span class="mono">site_id</span> 셀렉트(메인 관리자 전용) · 변경 시 해당 사이트 설정 로드</li>
                            <li><b>스토어 사용 여부</b> : <span class="mono">store_enabled = Y|N</span> (N이면 사이드 메뉴/인덱스 비노출)</li>
                            <li><b>결제 모드</b> : <span class="mono">real_payment = Y|N</span> (Y=Live 키, N=Test 키 자동 선택)</li>

                            <li class="flag"><i class="fa-solid fa-key"></i> <b>토스 페이 키(서브별)</b>
                                <ul class="list">
                                    <li>실결제 키 : <span class="mono">toss_live_client_key (live_ck_…)</span>, <span class="mono">toss_live_secret_key (live_sk_…)</span></li>
                                    <li>테스트 키 : <span class="mono">toss_test_client_key (test_ck_…)</span>, <span class="mono">toss_test_secret_key (test_sk_…)</span></li>
                                    <li>검증 규칙(프론트 패턴 검사) : <span class="mono">^live_ck_ / ^live_sk_ / ^test_ck_ / ^test_sk_</span></li>
                                    <li>모드 전환 시 강조 표시(해당 키 입력란 굵게) 및 플레이스홀더 전환</li>
                                </ul>
                            </li>

                            <li><b>배송 설정</b>
                                <ul class="list">
                                    <li>기본 배송사 : <span class="mono">default_courier</span> (예: CJ대한통운/롯데/우체국/한진)</li>
                                    <li>도서산간 안내 : <span class="mono">remote_area_notice</span> (상품 상세의 결제 버튼 위 안내용)</li>
                                    <li>배송비 : <span class="mono">shipping_fee_base</span> (원), <span class="mono">shipping_free_min</span> (무료배송 기준)</li>
                                    <li>※ 개별 상품에 별도 배송사/배송비가 있으면 개별 설정이 우선</li>
                                </ul>
                            </li>

                            <li><b>정책/고지 문구</b>
                                <ul class="list">
                                    <li>이용약관 : <span class="mono">policy_terms</span></li>
                                    <li>개인정보처리방침 : <span class="mono">policy_privacy</span></li>
                                    <li>환불/교환/배송정책 : <span class="mono">policy_refund_shipping</span></li>
                                    <li>푸터 노출 체크 : <span class="mono">show_terms_footer | show_privacy_footer | show_refund_footer</span></li>
                                </ul>
                            </li>
                        </ul>

                        <h3>검증·행동</h3>
                        <ul class="list">
                            <li><b>모드별 필수 키</b> : 실결제(Y)=<span class="mono">live_ck_/live_sk_</span>, 테스트(N)=<span class="mono">test_ck_/store_sk_</span> 없으면 저장 불가</li>
                            <li><b>Ping 테스트</b> : "키 유효성 검사"로 토스 API 연결 체크(읽기 전용)</li>
                            <li><b>권한</b> : 키 입력/수정은 기본 <u>메인 전용</u>(서브는 조회만)</li>
                            <li><b>노출 규칙</b> : <span class="mono">store_enabled = N</span>이면 메뉴/링크 숨김(권한·인덱스 규칙과 일치)</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="mono">
                            <li>GET  /api/admin/store/settings?site_id=…</li>
                            <li>POST /api/admin/store/settings</li>
                            <li>POST /api/admin/store/payment-config/store  (토스 키 연결 확인)</li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터 적용 후 동기화됩니다.
                        </div>
                    </div>
                </details>

                <!-- ADMIN 01_02 -->
                <details>
                    <summary>01_02 · 매출 통계 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_02.html" target="_blank"><span class="code">01_02</span> <span>매출 통계</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET /admin/store/stats</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                기간·사이트 조건으로 필터링하여 <b>매출/환불/실매출</b> 지표와 <u>주문 상태 분포, 결제수단·카테고리 비중, 매출 추이, TOP 상품</u>을 확인합니다.<br>
                                (상단 <u>사이트 선택</u>은 메인 관리자만)
                            </div>
                        </div>

                        <h3>필터/뷰</h3>
                        <ul class="list">
                            <li><b>기간 선택</b> : 연/월/일 드롭다운 · 빠른 선택 <span class="mono">오늘 / 최근 7일 / 이번달 / 지난달</span></li>
                            <li><b>사이트</b> : 전체 또는 특정 사이트(상단 셀렉트, <u>메인 관리자만 변경 가능</u>)</li>
                            <li><b>보기 단위</b> : <span class="mono">일별(daily) / 월별(monthly) / 시간대별(hourly)</span></li>
                            <li><b>내보내기</b> : 현재 차트/표 기준 <span class="mono">CSV</span> 다운로드</li>
                            <li><b>적용</b> : 필터 변경 후 <span class="mono">적용</span> 버튼으로 데이터 새로고침</li>
                        </ul>

                        <h3>지표/화면 구성</h3>
                        <ul class="list">
                            <li><b>KPI 카드(3개)</b> : 매출액, 환불액, 실매출(각각 전기 대비 증감 배지 표시)</li>
                            <li><b>주문 상태 박스</b> : 결제 · 준비중 · 배송중 · 완료 · 취소 · 반품(건수 표시)</li>
                            <li><b>도넛 차트</b> : 결제수단 비중(카드/가상계좌/간편결제 등), 카테고리 매출 비중</li>
                            <li><b>라인 차트(매출 추이)</b> : 시리즈 전환 <span class="mono">매출 / 실매출 / 환불</span></li>
                            <li><b>TOP 5 테이블</b> : 상품 순위(열: <span class="mono"># · 상품명 · SKU · 수량 · 매출액</span>) · 기준 전환 <span class="mono">수량/매출액</span></li>
                        </ul>

                        <h3>테이블/다운로드</h3>
                        <ul class="list">
                            <li><b>TOP 상품</b> : 상단 버튼으로 정렬 기준 전환(수량 ↔ 매출액)</li>
                            <li><b>CSV 내보내기</b> : 추이데이터(구간, 매출, 실매출, 환불) 다운로드</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="mono">
                            <li>GET /admin/store/stats?site_id=…&amp;year=YYYY&amp;month=MM&amp;day=DD&amp;granularity=daily|monthly|hourly</li>
                            <li>GET /admin/store/stats/export.csv?site_id=…&amp;from=YYYY-MM-DD&amp;to=YYYY-MM-DD&amp;granularity=…</li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터 적용 후 지표·차트·테이블이 동기화됩니다.
                        </div>
                    </div>
                </details>

                <!-- ADMIN 01_03 -->
                <details>
                    <summary>01_03 · 카테고리 관리 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_03.html" target="_blank"><span class="code">01_03</span> <span>카테고리 관리</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET /admin/store/categories</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>사이트별 카테고리를 등록/수정/삭제하고, 노출 여부와 표시 순서를 관리합니다.<br>(상단 <u>사이트 선택</u>은 메인 관리자만)</div>
                        </div>

                        <h3>화면 구성(퍼블리싱 반영)</h3>
                        <ul class="list">
                            <li><b>상단 선택</b> : 사이트 셀렉트(메인 관리자 전용)</li>
                            <li><b>필터</b> : 검색(이름/슬러그), 노출상태(Y/N), 상위 카테고리</li>
                            <li><b>목록 테이블</b> : 열 = <span class="mono">표시순서 · 카테고리명 · 슬러그 · 상위카테고리 · 노출 · 작업</span></li>
                            <li><b>페이징</b> : 페이지 이동 + 페이지당 개수(10/20/30/50)</li>
                            <li><b>작업</b> : 행 우측 <u>수정</u> / <u>삭제</u> 버튼</li>
                            <li><b>등록 버튼</b> : "카테고리 등록" → 모달 오픈</li>
                        </ul>

                        <h3>등록/수정 모달 필드</h3>
                        <ul class="list">
                            <li><b>카테고리명</b> (필수, 최대 80자)</li>
                            <li><b>URL 식별자(영문)</b> (필수, 최대 100자) · <u>자동 생성</u> 버튼 제공</li>
                            <li><b>상위 카테고리</b> (선택) · 루트로 둘 경우 "(없음)"</li>
                            <li><b>표시순서</b> (숫자, 기본 0) — 낮을수록 먼저 노출</li>
                            <li><b>노출</b> (체크 시 노출, 해제 시 숨김)</li>
                        </ul>

                        <h3>동작/검증</h3>
                        <ul class="list">
                            <li><b>URL 식별자(영문) 규칙</b> : 영문 소문자/숫자/하이픈만 허용, 공백·한글 제거 → <span class="mono">[a-z0-9-]</span></li>
                            <li><b>중복 방지</b> : 동일 사이트 내 식별자는 고유해야 함</li>
                            <li><b>자기 참조 금지</b> : 수정 시 <u>본인을 상위로 지정</u> 불가</li>
                            <li><b>정렬 기준</b> : 루트→자식 순으로, <span class="mono">표시순서 → 이름</span> 우선 정렬</li>
                            <li><b>삭제 제약</b> : 하위 카테고리나 연결 상품이 있으면 삭제 제한(확인 모달로 안내)</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="mono">
                            <li>GET /api/admin/store/categories?site_id=...&q=...&is_active=Y|N&parent_id=...&page=1&size=20</li>
                            <li>POST /api/admin/store/categories</li>
                            <li>PUT /api/admin/store/categories/:id</li>
                            <li>DELETE /api/admin/store/categories/:id</li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터/페이징 상태는 목록·모달 동작에 유지됩니다.
                        </div>
                    </div>
                </details>

                <!-- ADMIN 01_04 -->
                <details>
                    <summary>01_04 · 상품 관리 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_04.html" target="_blank"><span class="code">01_04</span> <span>상품 관리</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET /admin/store/products</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>사이트별 상품을 등록/수정/삭제하고, 판매 상태·카테고리·재고·가격을 관리합니다.<br>(상단 <u>사이트 선택</u>은 메인 관리자만)</div>
                        </div>

                        <h3>화면 구성</h3>
                        <ul class="list">
                            <li><b>상단 선택</b> : 사이트 셀렉트(메인 관리자 전용)</li>
                            <li><b>필터</b> : 검색(상품명/슬러그/SKU), 판매 상태(판매중/숨김/품절/중지), 카테고리</li>
                            <li><b>목록 테이블</b> : 열 = <span class="mono">이미지 · 상품명 · 슬러그 · 판매가 · 개별 배송비 · 재고 · 상태 · 카테고리 · 작업</span></li>
                            <li><b>페이징</b> : 페이지 이동 + 페이지당 개수(10/20/30/50)</li>
                            <li><b>작업</b> : 행 우측 <u>수정</u> / <u>삭제</u> 버튼</li>
                            <li><b>등록 버튼</b> : "상품 등록" → 모달 오픈</li>
                        </ul>

                        <h3>등록/수정 모달 필드</h3>
                        <ul class="list">
                            <li><b>상품명</b> (필수, 최대 120자)</li>
                            <li><b>슬러그</b> (필수, 최대 140자) · <u>자동 생성</u> 버튼 제공</li>
                            <li><b>간단 설명</b> (선택, 최대 300자)</li>
                            <li><b>가격</b> : 정가, 판매가(둘 중 하나는 반드시 입력)</li>
                            <li><b>개별 배송비</b> : 숫자(원) · <u>0 입력 시 스토어 기본 배송비</u> 적용</li>
                            <li><b>재고/SKU</b> : 재고(숫자), SKU(선택)</li>
                            <li><b>카테고리</b> : 단일 선택(퍼블리싱 기준)</li>
                            <li><b>판매 상태</b> : 판매중(active) / 숨김(hidden) / 품절(soldout) / 중지(archived)</li>
                            <li><b>대표 이미지</b> : 파일 선택 시 우측에 미리보기 노출(JPG/PNG 권장)</li>
                        </ul>

                        <h3>동작/표시 규칙</h3>
                        <ul class="list">
                            <li><b>상태 배지</b> : 판매중(녹색), 숨김(회색), 품절(노랑), 중지(빨강)</li>
                            <li><b>판매가 표시</b> : 판매가가 있으면 판매가, 없으면 정가</li>
                            <li><b>정렬(목록)</b> : 상태(판매중→숨김→품절→중지) → 카테고리명 → 상품명</li>
                        </ul>

                        <h3>검증</h3>
                        <ul class="list">
                            <li><b>필수</b> : 상품명, 슬러그</li>
                            <li><b>가격</b> : 정가 또는 판매가 중 최소 1개 입력, 값은 0 이상</li>
                            <li><b>슬러그 규칙</b> : 영문 소문자/숫자/하이픈만 허용(<span class="mono">[a-z0-9-]</span>) · 공백/한글 제거</li>
                            <li><b>재고</b> : 음수 불가</li>
                            <li><b>개별 배송비</b> : 0 이상(0이면 스토어 기본 적용)</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="mono">
                            <li>GET /api/admin/store/products?site_id=...&q=...&status=active|hidden|soldout|archived&category_id=...&page=1&size=20</li>
                            <li>POST /api/admin/store/products</li>
                            <li>PUT /api/admin/store/products/:id</li>
                            <li>POST /api/admin/store/products/:id/images</li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터/페이징 상태는 목록·모달 동작에 유지됩니다.<br>
                            가격·배송비가 모두 0인 경우에는 결제 테스트를 위한 값인지 실제 운영값인지 점검이 필요합니다.
                        </div>
                    </div>
                </details>

                <!-- ADMIN 01_05 -->
                <details>
                    <summary>01_05 · 주문/결제 관리 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_05.html" target="_blank"><span class="code">01_05</span> <span>주문/결제 관리</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET /admin/store/orders</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>결제 상태별 주문을 조회하고 <b>배송지·배송정보를 입력/수정</b>합니다.<br>(상단 <u>사이트 선택</u>은 메인 관리자만)</div>
                        </div>

                        <h3>화면 구성</h3>
                        <ul class="list">
                            <li><b>상단 선택</b> : 사이트 셀렉트(메인 관리자 전용)</li>
                            <li><b>필터</b> :
                                <ul class="list">
                                    <li>검색 : <u>주문번호 / 고객명 / 이메일 / 상품</u></li>
                                    <li>상태 : <u>결제대기(pay_wait) · 결제완료(paid) · 환불(refund) · 취소(cancel)</u></li>
                                    <li>페이지당 : 10/20/30/50</li>
                                </ul>
                            </li>
                            <li><b>목록 컬럼</b> : <span class="mono">주문번호 · 고객(이메일) · 상품/옵션 · 결제금액 · 결제상태 · 결제일시 · 배송지 · 배송정보 · 작업</span></li>
                            <li><b>배지 규칙</b> :
                                <ul class="list">
                                    <li>결제상태 : 결제대기(노랑) / 결제완료(녹색) / 환불(빨강) / 취소(회색)</li>
                                    <li>배송지 : 입력됨(파랑) / 미입력(빨강)</li>
                                    <li>배송정보 : 등록됨(녹색) / 미등록(노랑)</li>
                                </ul>
                            </li>
                        </ul>

                        <h3>액션</h3>
                        <ul class="list">
                            <li><b>배송 정보 입력/수정</b> (결제완료 건만 표시)
                                <br>→ 모달에서 <u>배송지</u>와 <u>배송정보</u> 입력 후 저장</li>
                            <li><b>배송확인하기</b> : 운송장 번호가 등록된 결제완료 건에 노출(배송사 페이지로 이동 연결 전제)</li>
                            <li><b>삭제</b> : 테스트/데모나 운영정책 허용 시 노출(정산/통계 영향 경고 필요)</li>
                        </ul>

                        <h3>배송 모달 필드</h3>
                        <ul class="list">
                            <li><b>배송지</b> : 수령인, 연락처, 우편번호/기본주소, 상세주소, 배송요청</li>
                            <li><b>배송정보(선택)</b> : 배송사(cj/lotte/krpost/hanjin/etc), 운송장 번호, 발송일, 배송 메모</li>
                            <li><b>저장 결과</b> : 목록의 ‘배송지/배송정보’ 배지 상태가 즉시 갱신</li>
                        </ul>

                        <h3>검증/권한</h3>
                        <ul class="list">
                            <li>배송 입력/수정은 <b>결제완료(paid)</b> 상태에서만 가능</li>
                            <li>배송지 필수 : 수령인, 연락처, 기본주소</li>
                            <li>운송장 번호는 선택이나, <u>배송확인하기</u> 노출 조건은 "운송장 번호 존재"</li>
                            <li>삭제는 권한 보유자만 가능, 이미 정산 반영된 주문은 제한</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="mono">
                            <li>GET /api/admin/store/orders?q=...&status=pay_wait|paid|refund|cancel&page=1&size=20</li>
                            <li>PUT /api/admin/store/orders/:id/address           <!-- 배송지 저장/수정 --></li>
                            <li>PUT /api/admin/store/orders/:id/shipping          <!-- 배송정보(택배사/운송장/발송일/메모) 저장/수정 --></li>
                            <li>GET /api/admin/store/orders/:id                   <!-- 상세 조회(주문서/결제로그/주소/배송) --></li>
                            <li>DELETE /api/admin/store/orders/:id                <!-- 정책 허용 시에만 사용 --></li>
                            <!-- (옵션) 운영 정책에 따라 제공 가능 -->
                            <li>POST /api/admin/store/orders/:id/cancel           <!-- 취소 처리 --></li>
                            <li>POST /api/admin/store/orders/:id/refund           <!-- 환불 처리 --></li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터/페이징 상태는 목록·모달 동작에 유지됩니다.<br>
                            "배송확인하기"는 운송장/배송사 입력 시에만 노출되며, 실제 서비스에서는 각 택배사 조회 URL과 연동합니다.
                        </div>
                    </div>
                </details>

                <!-- ADMIN 01_06 -->
                <details>
                    <summary>01_06 · 장바구니 조회 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_06.html" target="_blank"><span class="code">01_06</span> <span>장바구니 조회</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET /admin/store/carts</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>사이트·회원 기준 장바구니 현황을 조회하고 <b>KPI·정렬·검색</b>·<b>CSV</b>로 운영 인사이트를 확보합니다.<br>(상단 <u>사이트 선택</u>은 메인 관리자만)</div>
                        </div>

                        <h3>화면 구성</h3>
                        <ul class="list">
                            <li><b>KPI 카드</b> : 총 장바구니 수, 총 상품 수(개), 예상 매출 합계, 최근 추가(24h)</li>
                            <li><b>필터/정렬</b> :
                                <ul class="list">
                                    <li>기간 : 시작일 ~ 종료일</li>
                                    <li>사이트 : 사이트 전체/특정 사이트</li>
                                    <li>정렬 : <u>최근 담긴 순</u> · <u>금액 높은 순</u> · <u>수량 많은 순</u></li>
                                    <li>검색 : 회원ID/이름/상품명/SKU</li>
                                    <li>CSV 내보내기 : 현재 필터/정렬 결과를 파일로 저장</li>
                                </ul>
                            </li>
                            <li><b>데스크톱 표</b> : 페이지네이션(이전/다음, 현재 페이지 정보)</li>
                            <li><b>모바일 카드</b> : 화면 폭이 좁을 때 카드형 목록으로 자동 전환</li>
                        </ul>

                        <h3>목록 컬럼</h3>
                        <ul class="list">
                            <li><span class="mono">사이트</span> : 사이트 이름 배지</li>
                            <li><span class="mono">회원</span> : 회원ID(이름 마스킹)</li>
                            <li><span class="mono">상품</span> : 썸네일 · 상품명 · SKU</li>
                            <li><span class="mono">수량 / 단가 / 소계</span> : 단가는 <u>할인가가 정가보다 낮으면 할인가</u> 사용</li>
                            <li><span class="mono">담긴 시각</span> : YYYY-MM-DD hh:mm</li>
                            <li><span class="mono">기기</span> : mobile(초록) / pc(노랑) 배지</li>
                        </ul>

                        <h3>정의/계산</h3>
                        <ul class="list">
                            <li><b>예상 매출 합계</b> = Σ(단가 × 수량)</li>
                            <li><b>최근 추가(24h)</b> = 현재 시각 기준 24시간 내 담긴 레코드 수</li>
                            <li><b>단가 선택 로직</b> : <span class="mono">sale &lt; price ? sale : price</span></li>
                        </ul>

                        <h3>활용</h3>
                        <ul class="list">
                            <li>KPI로 트래픽 대비 구매 의도(장바구니 담기 강도) 파악</li>
                            <li>정렬·검색 후 <b>CSV</b>로 리마인드 대상(예: 고액/다량 장바구니) 추출</li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터/페이징 상태는 목록·모달 동작에 유지됩니다.<br>
                            메인 관리자는 상단의 <b>사이트 선택</b>을 통해 서브 사이트 데이터를 교차 조회할 수 있습니다.
                        </div>
                    </div>
                </details>

                <!-- ADMIN 01_07 -->
                <details>
                    <summary>01_07 · 쿠폰 발행 (관리자)</summary>
                    <div class="inner">
                        <div class="kv"><div>페이지 보기</div><div class="mono"><a class="link" href="store/01_07.html" target="_blank"><span class="code">01_07</span> <span>쿠폰 발행</span><span class="go"> <i class="fa-solid fa-arrow-up-right-from-square"></i></span></a></div></div>
                        <div class="kv"><div>URL</div><div class="mono">GET /admin/store/coupons</div></div>
                        <div class="kv">
                            <div>목적</div>
                            <div>정액/정율/무료배송 쿠폰을 <b>사이트 범위</b>와 <b>조건</b>에 맞게 생성·미리보기·발행합니다.<br>(상단 <u>사이트 선택</u>은 메인 관리자만)</div>
                        </div>

                        <h3>쿠폰 스펙</h3>
                        <ul class="list">
                            <li>유형: <b>정액(원)</b> · <b>정율(%)</b>(<u>최대할인 cap</u>) · <b>무료배송</b></li>
                            <li>범위: <b>전체</b> 또는 <b>특정 사이트(site_id)</b></li>
                            <li>조건: 최소주문금액, 유효기간(미지정 시 즉시/무기한), <b>중복 사용 허용 여부</b>(stackable)</li>
                            <li>발행 형태:
                                <ul class="list">
                                    <li><b>쿠폰코드</b> (공용/회원 지정) · <span class="mono">quota</span>=총 사용 횟수</li>
                                    <li><b>개별지급</b> (코드 없음, 회원ID 리스트) · <span class="mono">quota</span>=생성 건수</li>
                                </ul>
                            </li>
                            <li>미리보기: 현재 설정으로 <b>테이블/카드</b> 미리보기, 페이지네이션</li>
                            <li>내보내기: <b>CSV</b> (미리보기 결과 기준)</li>
                        </ul>

                        <h3>검증/정책</h3>
                        <ul class="list">
                            <li>정액: 할인값 &gt; 0</li>
                            <li>정율: 1–100 정수, <span class="mono">percent_cap</span> ≥ 0</li>
                            <li>기간: 시작일 ≤ 종료일</li>
                            <li>발급 수량: <span class="mono">quota</span> ≥ 1</li>
                            <li>코드형: 코드 패턴(영문/숫자/대시, 4–40자) 및 서버 <b>중복 불가</b> 검사</li>
                            <li>개별지급: <b>회원ID 필수</b> (없으면 발급 불가)</li>
                            <li>상태 전환: 만료/소진 시 <b>expired/exhausted</b> 자동 전환(배치/트리거)</li>
                            <li>중복 사용 규칙: <b>stackable=false</b>면 다른 쿠폰과 동시 사용 불가(정책표에 따름)</li>
                            <li>무료배송: 배송비만 0 처리(상품가/옵션가에는 미적용)</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="mono">
                            <li>GET  /api/admin/store/coupons                              · 목록/검색/페이지</li>
                            <li>POST /api/admin/store/coupons                              · 생성(정액/정율/무료배송)</li>
                            <li>PUT  /api/admin/store/coupons/:id                         · 수정</li>
                            <li>DELETE /api/admin/store/coupons/:id                       · 삭제</li>
                            <li>POST /api/admin/store/coupons/preview                     · 미리보기 행 생성</li>
                            <li>POST /api/admin/store/coupons/issue                        · 발행 실행(코드/개별)</li>
                            <li>GET  /api/admin/store/coupons/export.csv?…                · CSV 내보내기</li>
                            <li>POST /api/admin/store/coupons/import.csv                   · (옵션) 일괄 업로드</li>
                        </ul>

                        <h3>권장 필드 모델</h3>
                        <ul class="list mono">
                            <li>code, type(amount|percent|ship), value, percent_cap</li>
                            <li>site_id|ALL, valid_from, valid_to, min_amount, stackable</li>
                            <li>quota, per_user_limit(기본 1), max_use(옵션), target_user_ids[]</li>
                            <li>status(active|expired|exhausted|draft), created_by, created_at</li>
                        </ul>

                        <div class="note">
                            사이트 선택은 메인 관리자 전용이며 필터/페이징 상태는 목록·모달 동작에 유지됩니다.<br>
                            퍼블 화면에는 <b>요약 패널</b>(유형/값/기간/중복/수량/대상)과 <b>미리보기·CSV·발행</b> 버튼이 포함됩니다.
                        </div>
                    </div>
                </details>

                <!-- USER 02_01 -->
                <details>
                    <summary>02_01 · 스토어 홈/상품 리스트 (유저)</summary>
                    <div class="inner">
                        <div class="kv">
                            <div>페이지 보기</div>
                            <div class="mono">
                                <a class="link" href="store/02_01.html" target="_blank">
                                    <span class="code">02_01</span> <span>스토어 홈/상품 리스트</span>
                                    <span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span>
                                </a>
                            </div>
                        </div>
                        <div class="kv">
                            <div>URL</div>
                            <div class="mono">GET /member/store/</div>
                        </div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                사용자가 상품을 <b>검색/필터/정렬</b>하고 카드 목록에서 <b>장바구니/바로구매</b>를 수행합니다.
                                <span class="muted">가격은 부가세 포함 표기.</span>
                            </div>
                        </div>

                        <h3>화면/컴포넌트 (퍼블리싱 기준)</h3>
                        <ul class="list">
                            <li><b>상단 필터</b> : 검색(<span class="mono">q</span>), 카테고리(<span class="mono">category_id</span>), 정렬(<span class="mono">sort</span>), 페이지당(<span class="mono">size</span>) · 초기화/검색 버튼</li>
                            <li><b>그리드</b> : 반응형 카드(4→2→1열). 카드 = 썸네일·제목·카테고리·가격/할인·배지(NEW/SALE/품절)·액션(장바구니/바로구매)</li>
                            <li><b>페이지네이션</b> : 이전/다음 + 현재 페이지 버튼, 범위 정보 "총 N개 중 a–b 표시"</li>
                            <!-- (퍼블리싱 미구현) 빈 상태 문구는 실제 서비스에서 추가 권장 -->
                        </ul>

                        <h3>정렬/배지/가격 규칙</h3>
                        <ul class="list">
                            <li><b>정렬(sort)</b> :
                                <span class="mono">best</span>(기본, 품절 뒤로·할인율/신규 가중) ·
                                <span class="mono">latest</span>(신상품순, <span class="mono">created_at</span> 내림차순) ·
                                <span class="mono">low</span>(가격↑) · <span class="mono">high</span>(가격↓) ·
                                <span class="mono">sale</span>(할인율 높은 순)
                            </li>
                            <li><b>판매가 표기</b> : <span class="mono">sale_price &lt; price</span> 이면 <u>할인가(굵게)</u> + <u>정가 취소선</u>, 아니면 정가만 노출</li>
                            <li><b>할인율</b> : <span class="mono">round((1 - sale_price/price) * 100)</span></li>
                            <li><b>배지</b> : <u>품절</u>(<span class="mono">soldout=true</span>), <u>SALE</u>(할인율 &gt; 0), <u>NEW</u>(<span class="mono">created_at</span> ≤ 14일)</li>
                        </ul>

                        <h3>카드/액션</h3>
                        <ul class="list">
                            <li><b>카드 링크</b> : <span class="mono">/member/store/products/{slug}</span>
                                <span class="muted">· 퍼블 데모: <span class="mono">02_01_01.html?val=slug</span></span>
                            </li>
                            <li><b>바로구매</b> : 재고/품절 확인 후 <span class="mono">/member/store/checkout?product_id=…</span> 진입
                                <span class="muted">(데모는 알림창)</span>
                            </li>
                            <li><b>장바구니 담기</b> : <span class="mono">POST /api/member/carts</span> 후 미니카트/토스트 피드백
                                <span class="muted">(데모는 알림창)</span>
                            </li>
                            <li><b>품절 처리</b> : 버튼 <span class="mono">disabled</span>, 커서 기본</li>
                        </ul>

                        <h3>검증/UX</h3>
                        <ul class="list">
                            <li>검색 인풋 디바운스 ≈ 250ms</li>
                            <li>페이지 경계 보정 : <span class="mono">page &gt; total_pages → page = total_pages</span></li>
                            <li>접근성 : 카드 이미지 <span class="mono">alt</span>, 페이지 버튼 <span class="mono">aria-label</span>, 품절 시 버튼 <span class="mono">disabled</span></li>
                            <li>성능 권장 : 썸네일 지연 로딩(<span class="mono">loading="lazy"</span>) 적용</li>
                        </ul>

                        <h3>실서비스 API (참고)</h3>
                        <ul class="list mono">
                            <li>GET  /api/member/products?q=…&amp;category_id=…&amp;sort=…&amp;page=1&amp;size=12</li>
                            <li>POST /api/member/carts { product_id, qty }</li>
                        </ul>

                        <div class="note">
                            URL 쿼리 파라미터 동기화(예: <span class="mono">?q=&amp;category_id=&amp;sort=&amp;page=&amp;size</span>)와
                            빈 결과 안내 UI는 실서비스 적용 시 보완합니다.
                        </div>
                    </div>
                </details>

                <!-- USER 02_01_01 -->
                <details>
                    <summary>02_01_01 · 상품 상세 (유저)</summary>
                    <div class="inner">
                        <div class="kv">
                            <div>페이지 보기</div>
                            <div class="mono">
                                <a class="link" href="store/02_01_01.html" target="_blank">
                                    <span class="code">02_01_01</span> <span>상품 상세</span>
                                    <span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span>
                                </a>
                            </div>
                        </div>
                        <div class="kv">
                            <div>URL</div>
                            <div class="mono">GET /member/store/products/{slug}</div>
                        </div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                사용자가 상품 이미지/가격/옵션을 확인하고 <b>장바구니 담기</b> 또는 <b>바로구매</b>를 진행합니다.
                                <span class="muted">가격은 부가세 포함 표기.</span>
                            </div>
                        </div>

                        <h3>화면 구성(퍼블리싱 기준)</h3>
                        <ul class="list">
                            <li><b>이미지 갤러리</b> : 메인 이미지 + 썸네일 전환</li>
                            <li><b>가격 블록</b> : 할인가/정가/할인율 배지(조건부)</li>
                            <li><b>구매 영역</b> : 옵션(색상/구성), 수량, 재고, 액션 버튼(장바구니/바로구매)</li>
                            <li><b>안내</b> : 배송비(기본/무료조건/도서산간) 문구</li>
                            <li><b>탭</b> : 상세정보 / 리뷰 / Q&amp;A</li>
                            <li><b>관련 상품</b> : 4~8개 카드(품절/할인 배지 표시)</li>
                            <li><b>모바일 구매바</b> : 하단 고정(가격/장바구니/구매)</li>
                        </ul>

                        <h3>가격/배지 규칙</h3>
                        <ul class="list">
                            <li><b>판매가 표기</b> : <span class="mono">sale &lt; price</span> → <u>할인가(굵게)</u> + <u>정가 취소선</u>, 아니면 정가만</li>
                            <li><b>할인율</b> : <span class="mono">round((1 - sale/price) * 100)%</span></li>
                            <li><b>배지</b> : NEW(신규 노출 정책에 따라), SALE(할인율 &gt; 0), 품절(soldout)</li>
                        </ul>

                        <h3>옵션/수량/재고</h3>
                        <ul class="list">
                            <li><b>옵션</b> : 색상/구성(선택값 바인딩). 퍼블 샘플은 기본 선택값 제공</li>
                            <li><b>수량</b> : 기본 1, 증감 버튼, 최소 1</li>
                            <li><b>재고</b> : 현재 재고 수량 텍스트 표시</li>
                            <li><b>품절 처리</b> : 품절일 경우 구매 액션 비활성</li>
                        </ul>

                        <h3>카드/액션</h3>
                        <ul class="list">
                            <li><b>장바구니</b> : <span class="mono">POST /api/member/carts</span> { product_id, qty, options... } → 미니카트/토스트</li>
                            <li><b>바로구매</b> : 재고 확인 후 <span class="mono">/member/store/checkout?product_id=…</span> 진입</li>
                            <li><b>관련 상품</b> : 카드 링크 <span class="mono">/member/store/products/{slug}</span></li>
                        </ul>

                        <h3>검증/UX</h3>
                        <ul class="list">
                            <li>수량 최소 1(정수). 재고 부족/품절 시 액션 disabled</li>
                            <li>갤러리 썸네일 전환 시 포커스/활성 상태 반영</li>
                            <li>접근성 : 이미지 <span class="mono">alt</span>, 탭 버튼 토글, 버튼 <span class="mono">disabled</span></li>
                            <li>모바일 : 하단 구매바 노출, 본문 하단 패딩 확보</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="list mono">
                            <li>GET  /api/member/products/{slug}</li>
                            <li>POST /api/member/carts { product_id, qty, options }</li>
                        </ul>

                        <div class="note">
                            퍼블리싱 데모는 알림창으로 액션을 대체합니다.
                            실제 서비스에서는 장바구니/체크아웃 API 연동 및 옵션/재고 검증을 서버에서 재확인해야 합니다.
                        </div>
                    </div>
                </details>

                <!-- USER 02_01_02 -->
                <details>
                    <summary>02_01_02 · 주문/결제(체크아웃) (유저)</summary>
                    <div class="inner">
                        <div class="kv">
                            <div>페이지 보기</div>
                            <div class="mono">
                                <a class="link" href="store/02_01_02.html" target="_blank">
                                    <span class="code">02_01_02</span> <span>주문/결제</span>
                                    <span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span>
                                </a>
                            </div>
                        </div>
                        <div class="kv">
                            <div>URL</div>
                            <div class="mono">GET /member/store/checkout</div>
                        </div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                장바구니 품목과 배송/결제 정보를 확인·입력하고 <b>쿠폰 적용</b> 후 <b>결제</b>를 진행합니다.
                                <span class="muted">모든 가격은 부가세 포함 표기.</span>
                            </div>
                        </div>

                        <h3>화면/컴포넌트(퍼블 기준)</h3>
                        <ul class="list">
                            <li><b>주문자 정보</b> : 이름, 이메일, 휴대폰, 요청사항(선택)</li>
                            <li><b>배송지 정보</b> : 수령인, 연락처, 주소(주소검색 버튼), 상세주소, 배송요청/수령장소</li>
                            <li><b>주문 상품</b> : 썸네일 · 제목 · 옵션·수량 · 라인 합계</li>
                            <li><b>쿠폰</b> : 셀렉트(예: 3,000원 / 10% 최대 10,000원) + 적용 버튼</li>
                            <li><b>요약</b> : 상품금액 · 할인금액 · 배송비 · 결제예정금액 · 결제 버튼</li>
                            <li><b>모바일 구매바</b> : 하단 고정(결제예정금액/결제)</li>
                        </ul>

                        <h3>입력/검증</h3>
                        <ul class="list">
                            <li><b>필수</b> : 주문자(이름/이메일/휴대폰), 배송지(수령인/연락처/기본주소)</li>
                            <li><b>약관 동의</b> : 결제 활성 조건(체크박스 id=<span class="mono">agreeAll</span>)</li>
                            <li><b>폼 검증 실패</b> 시 토스트/얼럿 안내 후 포커스 이동</li>
                        </ul>

                        <h3>금액 계산 로직</h3>
                        <ul class="list">
                            <li><b>라인 단가</b> : <span class="mono">(sale &lt; price ? sale : price)</span></li>
                            <li><b>상품금액(정가합)</b> = Σ(<span class="mono">price × qty</span>)</li>
                            <li><b>할인 전 합계</b> = Σ(<span class="mono">lineUnit × qty</span>)</li>
                            <li><b>기본 할인</b> = 상품금액 − 할인 전 합계</li>
                            <li><b>쿠폰</b>
                                <ul class="list">
                                    <li>정액 3,000원 : +3,000원 추가 할인</li>
                                    <li>정율 10% : <span class="mono">min(⌊합계×0.10⌋, 10,000)</span></li>
                                </ul>
                            </li>
                            <li><b>배송비</b> : 기본 3,000원, <u>3만 원 이상 무료</u> (퍼블 상수: <span class="mono">SHIPPING_BASE=3000, SHIPPING_FREE_MIN=30000</span>)</li>
                            <li><b>결제예정금액</b> = (할인 전 합계 − (기본 할인 + 쿠폰)) + 배송비</li>
                        </ul>

                        <h3>결제 연동(개요)</h3>
                        <ul class="list">
                            <li>스토어 설정으로 <b>결제 키</b> 로딩(실/테스트)</li>
                            <li>Toss 결제 Intent 생성 → 결제 요청</li>
                            <li>성공 콜백 검증 후 주문 <span class="mono">status=paid</span> 확정</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="list mono">
                            <li>GET  /api/member/carts/current                                <!-- 서버 기준 장바구니 조회 --></li>
                            <li>POST /api/member/checkout                                      <!-- 결제 intent 생성 --></li>
                            <li>POST /api/member/orders/confirm                                <!-- 결제 성공 검증/확정 --></li>
                            <li>POST /api/member/coupons/validate { code|id }                  <!-- 쿠폰 재검증(선택) --></li>
                        </ul>

                        <div class="note">
                            퍼블 데모는 쿠폰/결제 동작을 얼럿으로 대체합니다. 실제 서비스에서는 서버 계산값을 신뢰하며,
                            <b>쿠폰/배송비/총액</b>을 서버에서 재산출·검증해야 합니다.
                        </div>
                    </div>
                </details>

                <!-- USER 02_02 -->
                <details>
                    <summary>02_02 · 장바구니 (유저)</summary>
                    <div class="inner">
                        <div class="kv">
                            <div>페이지 보기</div>
                            <div class="mono">
                                <a class="link" href="store/02_02.html" target="_blank">
                                    <span class="code">02_02</span> <span>장바구니</span>
                                    <span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span>
                                </a>
                            </div>
                        </div>
                        <div class="kv">
                            <div>URL</div>
                            <div class="mono">GET /member/store/cart</div>
                        </div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                선택/수량/삭제/쿠폰 적용을 통해 결제예정금액을 확인하고, <b>선택 항목</b> 기준으로 체크아웃으로 이동합니다.
                                <span class="muted">모든 가격은 부가세 포함 표기.</span>
                            </div>
                        </div>

                        <h3>화면/컴포넌트</h3>
                        <ul class="list">
                            <li><b>헤더</b> : 전체선택 체크박스, 선택삭제/전체비우기 버튼</li>
                            <li><b>리스트</b> : 썸네일 · 제목 · 옵션/메타(SKU/색상/구성) · 수량(±/입력) · 세일 배지 · 개별 삭제 · 라인 합계(정가/할인가)</li>
                            <li><b>요약 패널</b> : 쿠폰 선택/적용, 상품금액 · 할인금액 · 배송비 · 결제예정금액, 주문 버튼</li>
                            <li><b>모바일 구매바</b> : 하단 고정(결제예정금액/주문)</li>
                            <li><b>빈 상태</b> : "장바구니가 비어 있습니다" + 쇼핑으로 이동 CTA</li>
                        </ul>

                        <h3>동작/검증</h3>
                        <ul class="list">
                            <li><b>선택</b> : 전체선택 ↔ 행 선택 동기화, 선택 항목만 합계·주문 대상</li>
                            <li><b>수량</b> : 1~999로 클램프, 입력/± 버튼 즉시 반영</li>
                            <li><b>가격 로직(라인)</b> : <span class="mono">unit = (sale &lt; price ? sale : price)</span>, <span class="mono">line = unit × qty</span></li>
                            <li><b>쿠폰</b> :
                                <ul class="list">
                                    <li>정액 3,000원 : 할인금액 +3,000</li>
                                    <li>정율 10% : <span class="mono">min(⌊선택합계 × 0.10⌋, 10,000)</span></li>
                                    <li>적용/해제 시 합계 즉시 갱신</li>
                                </ul>
                            </li>
                            <li><b>합계</b> (선택 항목 기준)
                                <ul class="list">
                                    <li>상품금액 = Σ(<span class="mono">price × qty</span>)</li>
                                    <li>할인금액 = (상품금액 − Σ(<span class="mono">unit × qty</span>)) + 쿠폰</li>
                                    <li>배송비 = 기본 3,000원, <u>500,000원 이상 무료</u></li>
                                    <li>결제예정금액 = Σ(<span class="mono">unit × qty</span>) − 할인금액 + 배송비</li>
                                </ul>
                            </li>
                            <li><b>주문</b> : 선택 항목 없으면 경고, 있으면 체크아웃으로 이동</li>
                        </ul>

                        <h3>상수(퍼블 데모)</h3>
                        <ul class="list mono">
                            <li>SHIPPING_BASE = 3000</li>
                            <li>SHIPPING_FREE_MIN = 500000</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="list mono">
                            <li>GET  /api/member/carts/current                          <!-- 장바구니 조회 --></li>
                            <li>PATCH /api/member/carts/lines/:id { qty }               <!-- 수량 변경 --></li>
                            <li>POST /api/member/carts/coupon { code|id }               <!-- 쿠폰 적용/검증 --></li>
                            <li>DELETE /api/member/carts/lines                          <!-- 선택 삭제(배열) --></li>
                            <li>DELETE /api/member/carts                                <!-- 전체 비우기 --></li>
                            <li>POST /api/member/checkout                               <!-- 선택 항목으로 체크아웃 생성 --></li>
                        </ul>

                        <div class="note">
                            합계 계산은 클라이언트에 즉시 반영하되, 실제 결제 직전 서버에서 <b>쿠폰/배송비/총액</b>을 재산출·검증해야 합니다.
                        </div>
                    </div>
                </details>

                <!-- USER 02_03 -->
                <details>
                    <summary>02_03 · 주문/결제 내역 (유저)</summary>
                    <div class="inner">
                        <div class="kv">
                            <div>페이지 보기</div>
                            <div class="mono">
                                <a class="link" href="store/02_03.html" target="_blank">
                                    <span class="code">02_03</span> <span>주문/결제 내역</span>
                                    <span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span>
                                </a>
                            </div>
                        </div>
                        <div class="kv">
                            <div>URL</div>
                            <div class="mono">GET /member/store/orders</div>
                        </div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                기간/상태/검색으로 주문을 조회하고, 주문별 상세(상품·금액·배송/결제)를 확인하거나
                                <b>영수증/취소/반품/배송조회</b>를 수행합니다. <span class="muted">결제 수단은 토스페이 기준.</span>
                            </div>
                        </div>

                        <h3>화면/컴포넌트</h3>
                        <ul class="list">
                            <li><b>필터 바</b> : 빠른 기간(7일/1개월/3개월/전체), 시작~종료일, 상태 셀렉트, 검색(주문번호/상품명)</li>
                            <li><b>주문 카드</b> :
                                헤더(주문번호·일자·수령인·결제수단·<u>상태 배지</u>) /
                                본문(아이템 리스트: 썸네일·제목·옵션·수량·라인가) /
                                푸터(상품금액·할인·배송비·결제금액 요약 + 액션 버튼)</li>
                            <li><b>상세 토글</b> : 카드 우측 <span class="mono">상세</span> 버튼으로 본문 접기/펼치기</li>
                            <li><b>페이지네이션</b> : 이전/다음, 현재 페이지 표시(예: <span class="mono">1 / N</span>)</li>
                            <li><b>빈 상태</b> : "표시할 주문이 없습니다. 기간/상태/검색어를 조정해 보세요."</li>
                        </ul>

                        <h3>상태/배지</h3>
                        <ul class="list">
                            <li><span class="mono">결제완료</span> · <span class="mono">상품준비중</span> → <span class="badge warn">경고색</span></li>
                            <li><span class="mono">배송중</span> · <span class="mono">배송완료</span> → <span class="badge ok">성공색</span></li>
                            <li><span class="mono">취소</span> · <span class="mono">환불완료</span> → <span class="badge danger">위험색</span></li>
                            <li>미정/기타 → <span class="badge gray">중립색</span></li>
                        </ul>

                        <h3>합계/표시 규칙</h3>
                        <ul class="list">
                            <li>상품금액 = Σ(<span class="mono">item.price × item.qty</span>)</li>
                            <li>결제금액 = <span class="mono">상품금액 − 할인금액 + 배송비</span></li>
                            <li>표기 : 통화는 <b>원</b>, <span class="mono">fmtKRW(n)</span> 형식(3자리 콤마 + "원")</li>
                        </ul>

                        <h3>액션</h3>
                        <ul class="list">
                            <li><b>영수증</b> : 토스페이 영수증 보기</li>
                            <li><b>주문취소</b> : 상태가 <span class="mono">결제완료</span> 또는 <span class="mono">상품준비중</span>인 경우 노출</li>
                            <li><b>반품신청</b> : 상태가 <span class="mono">배송완료</span>인 경우 노출</li>
                            <li><b>배송조회</b> : 상태가 <span class="mono">배송중/배송완료</span>인 경우 노출</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="list mono">
                            <li>GET  /api/member/orders?from=YYYY-MM-DD&amp;to=YYYY-MM-DD&amp;status=…&amp;q=…&amp;page=1&amp;size=10</li>
                            <li>GET  /api/member/orders/:order_id                       <!-- 상세 조회 --></li>
                            <li>POST /api/member/orders/:order_id/cancel                <!-- 취소 요청 --></li>
                            <li>POST /api/member/orders/:order_id/return                <!-- 반품/교환 요청 --></li>
                            <li>GET  /api/member/orders/:order_id/receipt               <!-- 영수증 링크/데이터 --></li>
                            <li>GET  /api/member/orders/:order_id/shipment/track        <!-- 배송조회 --></li>
                        </ul>

                        <div class="note">
                            목록의 금액 요약은 표시 편의를 위한 값이며, 취소/반품 가능 여부와 최종 정산 금액은 서버 정책/상태에 따라 재검증합니다.
                        </div>
                    </div>
                </details>

                <!-- USER 02_04 -->
                <details>
                    <summary>02_04 · 쿠폰 (유저)</summary>
                    <div class="inner">
                        <div class="kv">
                            <div>페이지 보기</div>
                            <div class="mono">
                                <a class="link" href="store/02_04.html" target="_blank">
                                    <span class="code">02_04</span> <span>쿠폰</span>
                                    <span class="go"><i class="fa-solid fa-arrow-up-right-from-square"></i></span>
                                </a>
                            </div>
                        </div>
                        <div class="kv">
                            <div>URL</div>
                            <div class="mono">GET /member/store/coupons</div>
                        </div>
                        <div class="kv">
                            <div>목적</div>
                            <div>
                                보유 쿠폰을 조회/필터링하고 <b>코드 등록</b> 및 <b>할인 미리보기</b>로 적용 가능 금액을 확인합니다.
                            </div>
                        </div>

                        <h3>화면/컴포넌트</h3>
                        <ul class="list">
                            <li><b>툴바</b> : 상태 필터 <span class="mono">전체 · 사용 가능 · 사용됨 · 만료</span> + 쿠폰 코드 입력/등록</li>
                            <li><b>쿠폰 리스트</b> : 배지(정액/정율), 제목, 조건(최소금액), 유효기간, 상태 배지(<u>사용 가능/사용됨/만료</u>), <span class="mono">선택/상세</span> 버튼</li>
                            <li><b>적용 미리보기</b> : 장바구니 금액 입력 → 선택 쿠폰 기준 <u>할인금액</u>과 <u>예상 결제금액</u> 산출</li>
                            <li><b>모바일 하단바</b> : 예상 결제금액 + 적용 버튼(동일 동작)</li>
                        </ul>

                        <h3>계산/적용 규칙</h3>
                        <ul class="list">
                            <li><b>정액</b>(amount) : <span class="mono">할인 = min(금액, 장바구니합계)</span></li>
                            <li><b>정율</b>(percent) : <span class="mono">raw = floor(합계 × rate/100)</span> → <span class="mono">할인 = min(raw, cap, 합계)</span></li>
                            <li><b>최소 주문 금액</b> : <span class="mono">subtotal &lt; minSpend</span> 이면 적용 불가</li>
                            <li><b>유효기간/상태</b> : 만료일 지난 쿠폰 또는 <span class="mono">used</span> 상태는 선택/적용 불가</li>
                            <li><b>표시 포맷</b> : 통화는 3자리 콤마 + "원"(예: <span class="mono">fmtKRW(n)</span>)</li>
                        </ul>

                        <h3>검증/정책</h3>
                        <ul class="list">
                            <li><b>코드 입력</b> : 영문/숫자/하이픈, 대소문자 무시, 길이 4–40자 <span class="mono">[A-Za-z0-9-]{4,40}</span></li>
                            <li><b>중복</b> : 동일 코드 재등록 불가(서버 중복 검사)</li>
                            <li><b>미리보기</b> : 클라이언트 계산은 안내용, 결제 단계에서 서버가 최종 재검증</li>
                        </ul>

                        <h3>API (예시)</h3>
                        <ul class="list mono">
                            <li>GET  /api/member/coupons                                 · 목록/상태 필터</li>
                            <li>POST /api/member/coupons/redeem { code }                 · 코드 등록</li>
                            <li>POST /api/member/coupons/preview { coupon_id, subtotal } · 할인 미리보기</li>
                            <!-- 실제 결제 적용은 장바구니/체크아웃 API에서 처리 -->
                        </ul>

                        <div class="note">
                            쿠폰 적용은 결제 직전에 서버에서 <u>최소금액·기간·최대할인</u>을 다시 검증합니다. 무료배송 쿠폰은 스토어 설정의 배송비 로직과 함께 처리됩니다.
                        </div>
                    </div>
                </details>
              </div>
            </details>
        </section>

        <!-- 6. 결제/주문 플로우 -->
        <section class="card" id="sec-6">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 6) 결제/주문 플로우 (단건 결제만)</summary>
              <div class="fold-body">

                <!-- 한눈에 보는 흐름 -->
                <div class="note">
                    <b>구매 흐름</b> :
                    <u>상품 보기 → 담기 → 장바구니 확인 → 결제 정보 입력 → 결제 완료 → 주문 확인</u><br/>
                    화면에 보이는 버튼/문구 기준으로 설명합니다.
                </div>

                <!-- 단계별 상세 -->
                <ol class="list" style="margin-top:8px">
                    <li>
                        <b>상품 상세(02_01_01)</b>
                        <ul class="list">
                            <li><b>하는 일</b> : 색상/구성 선택, 수량 정하기, 가격·배송비 확인</li>
                            <li><b>버튼</b> : <u>장바구니</u> 또는 <u>바로구매</u></li>
                            <li><b>안내</b> : 옵션 미선택 시 구매 버튼 비활성(퍼블리싱 상 버튼/수량 컨트롤 제공)</li>
                        </ul>
                    </li>

                    <li>
                        <b>장바구니(02_02)</b>
                        <ul class="list">
                            <li><b>하는 일</b> : 담긴 상품 확인, 수량 변경(± 버튼/직접입력), 선택 삭제/전체 비우기</li>
                            <li><b>쿠폰</b> : 드롭다운에서 <u>3,000원 할인</u> 또는 <u>10% 할인(최대 10,000원)</u> 선택 후 <u>적용</u></li>
                            <li><b>합계</b> :
                                <u>상품금액 − 할인 + 배송비 = 결제예정금액</u> 자동 계산</li>
                            <li><b>무료배송 기준</b> : 데모 문구는 <u>500,000원 이상</u> 무료(배송비 3,000원)로 노출되어 있음</li>
                            <li><b>다음</b> : <u>주문하기</u> 버튼 → 체크아웃(주문/결제) 화면으로 이동</li>
                        </ul>
                    </li>

                    <li>
                        <b>주문/결제(체크아웃, 02_01_02)</b>
                        <ul class="list">
                            <li><b>입력</b> : 주문자 정보(이름/이메일/연락처), 배송지(이름/연락처/주소/상세), 요청사항, 약관 동의(문구)</li>
                            <li><b>쿠폰 재확인</b> : 장바구니에서 선택한 쿠폰을 다시 선택/해제 가능</li>
                            <li><b>최종 금액</b> : <u>결제예정금액</u> 굵게 표시, 모바일 하단 고정 바에도 금액 표시</li>
                            <li><b>배송비 문구</b> : <u>500,000원 이상</u> 무료(배송비 3,000원)로 노출되어 있음</li>
                            <li><b>결제하기</b> : 누르면 결제창 오픈(카드/간편결제 등). 폼 필수값 미입력 시 안내 후 진행 불가(알림)</li>
                        </ul>
                    </li>

                    <li>
                        <b>결제 진행(결제창)</b>
                        <ul class="list">
                            <li><b>사용자</b> : 결제수단 선택 → 인증(앱/비밀번호 등)</li>
                            <li><b>성공</b> : "결제가 완료되었습니다." 안내 후 완료 화면 또는 <u>주문/결제 내역</u>으로 이동(데모 알림 흐름 존재)</li>
                            <li><b>실패</b> : 실패 사유 안내 후 체크아웃으로 복귀, 정보 유지 상태에서 <u>결제하기</u> 재시도</li>
                        </ul>
                    </li>

                    <li>
                        <b>완료 & 확인(02_03 · 주문/결제 내역)</b>
                        <ul class="list">
                            <li><b>내용</b> : 주문번호, 수령인, 결제수단(토스페이), 금액 요약, 상품 리스트</li>
                            <li><b>버튼</b> : <u>영수증</u>, 상태별로 <u>주문취소</u>(결제완료/상품준비중), <u>반품신청</u>(배송완료), <u>배송조회</u>(배송중/완료) 제공(데모 동작)</li>
                        </ul>
                    </li>
                </ol>

                <!-- 추가 안내 : 배송/취소/환불 -->
                <div class="mt12">
                    <h3>추가 안내 (배송 · 취소/환불 · 쿠폰/오류)</h3>
                    <ul class="list">
                        <li><b>배송</b> : 결제 완료 후 관리자 운송장 등록 시 <u>배송조회</u> 버튼 활성(주문 내역 화면에서 확인)</li>
                        <li><b>취소/환불</b> : 출고 전에는 취소, 배송완료 후에는 반품/환불 프로세스(주문 내역 버튼으로 요청)</li>
                        <li><b>쿠폰</b> : 3,000원 정액 또는 10% 정율(최대 10,000원) 정책 데모 구성. 체크아웃에서도 재적용 가능 </li>
                        <li><b>오류 해결</b> : 결제창 닫힘/실패 시 체크아웃에서 <u>결제하기</u>로 재시도(입력값 유지)</li>
                    </ul>
                </div>

                <!-- 시나리오 예시 -->
                <details class="mt12">
                    <summary>예시 시나리오 2가지 (성공/실패)</summary>
                    <div class="inner">
                        <div class="chips mt8">
                            <span class="tag">시나리오 A · 정상 결제</span>
                            <span class="tag">시나리오 B · 결제 실패 후 재시도</span>
                        </div>

                        <h3 class="mt12">A) 정상 결제</h3>
                        <ol class="list">
                            <li>상품 상세에서 옵션/수량 선택 → <u>바로구매</u></li>
                            <li>체크아웃에서 배송지·약관 동의 → <u>결제하기</u></li>
                            <li>결제창 인증 완료 → 완료 안내 후 주문 내역에서 확인</li>
                        </ol>

                        <h3 class="mt12">B) 결제 실패 후 재시도</h3>
                        <ol class="list">
                            <li>체크아웃에서 <u>결제하기</u> → 인증 실패</li>
                            <li>실패 안내 후 체크아웃으로 복귀(입력값 유지)</li>
                            <li><u>결제하기</u> 재클릭 → 결제창 재오픈 → 인증 성공</li>
                            <li>주문 내역에서 상태 확인 및 영수증/취소/배송조회 등 사용</li>
                        </ol>
                    </div>
                </details>

                <!-- 정책 상이 안내 -->
                <div class="note mt12">
                    <b>무료배송 기준 문구</b><br/>
                    <u>500,000원 이상 무료</u>는 임의 값이며 관리자별 설정 가능
                </div>

                <!-- 한 줄 핵심 -->
                <div class="note mt12">
                    <b>핵심 정리</b><br/>
                    1) 장바구니에서 금액·쿠폰을 확정하고, 2) 체크아웃에서 주소/동의를 완료한 뒤, 3) 결제창에서 결제하면, 4) 주문 내역에서 영수증/취소/배송조회까지 처리합니다. 
                </div>
              </div>
            </details>
        </section>

        <!-- 7. 보안/검증 -->
        <section class="card" id="sec-7">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 7) 보안/검증</summary>
              <div class="fold-body">

                <!-- 목적 -->
                <div class="note">
                    고객의 결제·개인정보를 안전하게 지키고 실수나 악의적 시도를 미리 막기 위한 <b>운영 수칙</b>입니다.
                </div>

                <!-- 관리자/서브관리자 접근 -->
                <h3>7.1 관리자 로그인 및 권한</h3>
                <ul class="list">
                    <li><b>로그인 필수</b> : 관리자 화면은 로그인 없이는 접근할 수 없습니다.</li>
                    <li><b>권한 구분</b> :
                        <ul class="list">
                            <li><b>메인 관리자</b> : 모든 서브 관리자 사이트의 스토어 정보 열람/수정 가능</li>
                            <li><b>서브 관리자</b> : <u>자신의 사이트</u> 정보만 열람/수정 가능</li>
                        </ul>
                    </li>
                    <li><b>사이트 소유 확인</b> : 서브 관리자가 다른 사이트 데이터에 접근하려 하면 차단됩니다.</li>
                    <li><b>이중 확인</b> : 민감 변경(환불 실행, 쿠폰 대량 발급 등)은 추가로 비밀번호 재확인 또는 승인 절차를 거칩니다.</li>
                </ul>

                <!-- 일반 사용자 보호 -->
                <h3>7.2 유저(구매자) 보호</h3>
                <ul class="list">
                    <li><b>로그인/세션</b> : 장바구니·주문 내역은 로그인(또는 일시 세션) 상태에서만 확인됩니다.</li>
                    <li><b>잘못된 요청 차단</b> : 화면에서 보낸 요청이 맞는지 확인하여 위조된 결제/주문 시도를 막습니다.</li>
                    <li><b>주소/연락처 입력</b> : 필수 항목 누락 시 결제가 진행되지 않도록 안내 메시지가 뜹니다.</li>
                </ul>

                <!-- 결제 안전장치 -->
                <h3>7.3 결제 안전장치</h3>
                <ul class="list">
                    <li><b>금액 일치 확인</b> : 고객이 보는 금액과 실제 결제 요청 금액이 다르면 결제가 중단됩니다.</li>
                    <li><b>주문번호 검증</b> : 중복 결제 방지를 위해 한 주문번호로 한 번만 결제 승인됩니다.</li>
                    <li><b>결제 응답 확인</b> : 결제 성공 통보가 오면 시스템이 <u>정상적인 결제사로부터 온 것</u>인지 서명을 확인합니다.</li>
                    <li><b>웹훅 보안</b> : 결제사(토스)에서 보내는 결과 통보에 <u>비밀키</u>가 맞지 않으면 반영하지 않습니다.</li>
                </ul>

                <!-- 개인정보 취급 -->
                <h3>7.4 개인정보 보호</h3>
                <ul class="list">
                    <li><b>표시 최소화</b> : 주문 목록 등에서는 이름 일부 전화번호 일부만 보이도록 <u>마스킹</u>할 수 있습니다.</li>
                    <li><b>보관 기간</b> : 주문·배송에 필요한 기간 동안만 보관하고 내부 정책에 따라 파기하거나 별도로 보관합니다.</li>
                    <li><b>다운로드 관리</b> : 주문 엑셀 다운로드는 관리자만 가능하며 반출 시 암호 설정을 권장합니다.</li>
                </ul>

                <!-- 변경·위험 행위 기록 -->
                <h3>7.5 감사 로그(누가 무엇을 했는지)</h3>
                <ul class="list">
                    <li><b>기록 대상</b> : 결제·환불 처리, 쿠폰 생성/삭제, 설정 변경 등</li>
                    <li><b>활용</b> : 문제 발생 시 <u>언제·누가·어떤 항목을</u> 변경했는지 추적하여 신속히 원인을 파악합니다.</li>
                </ul>

                <!-- 오류/사고 대응 -->
                <h3>7.6 사고 대응 절차</h3>
                <ul class="list">
                    <li><b>결제 오류</b> : 동일 주문 재결제 안내 전, 먼저 결제사 상태를 확인하고 중복 청구 여부를 점검합니다.</li>
                    <li><b>오입력/오배송</b> : 주문 잠금(수정 제한) → 고객 안내 → 취소/재배송/환불 절차 진행</li>
                    <li><b>개인정보 오노출</b> : 즉시 화면에서 가림 처리(마스킹), 관련자 공지 및 재발 방지 조치</li>
                </ul>

                <!-- 운영 수칙 요약 -->
                <div class="note">
                    <b>운영시 지켜야 할 3가지</b> :
                    ① <u>권한</u>을 지켜 필요한 사람만 접근하게 하고,
                    ② <u>결제</u>는 금액·주문번호·서명을 꼭 확인하며,
                    ③ <u>개인정보</u>는 최소한만 표시하고 모든 변경을 기록합니다.
                </div>
              </div>
            </details>
        </section>

        <!-- 8. 로그/통계 -->
        <section class="card" id="sec-8">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 8) 로깅·통계</summary>
              <div class="fold-body">

                <!-- 무엇을, 왜 보는가 (01_02 화면 기준) -->
                <div class="note">
                    본 섹션은 <b>매출 통계(01_02)</b> 화면 구성에 맞춰 작성되었습니다.<br>
                    필터로 기간·사이트·보기단위를 정한 뒤, 상단 <b>KPI 카드</b>와 <b>차트/테이블</b>로 현황을 확인합니다.
                </div>

                <!-- 화면 상단 필터 -->
                <h3>8.1 조회 조건(화면 상단 필터)</h3>
                <ul class="list">
                    <li><b>기간</b> : 연/월/일 셀렉트</li>
                    <li><b>사이트</b> : 전체 또는 특정 사이트 선택</li>
                    <li><b>보기 단위</b> : <u>일별 / 월별 / 시간대별</u></li>
                    <li><b>빠른 선택</b> : <u>오늘 · 최근 7일 · 이번달 · 지난달</u></li>
                    <li><b>버튼</b> : <u>CSV</u> 내보내기, <u>적용</u></li>
                </ul>

                <!-- KPI 카드 -->
                <h3>8.2 핵심 지표(KPI 카드)</h3>
                <ul class="list">
                    <li><b>매출액</b> : 선택 기간 총 매출(할인/배송비 포함)</li>
                    <li><b>환불액</b> : 승인된 환불 금액 합계</li>
                    <li><b>실매출</b> : <u>매출액 − 환불액</u></li>
                    <li><b>전기 대비</b> : 각 카드 우측 <span class="mono">+/-%</span> 배지로 추세 표시</li>
                </ul>

                <!-- 주문 상태 요약 -->
                <h3>8.3 주문 상태 요약</h3>
                <ul class="list">
                    <li><u>결제</u> · <u>준비중</u> · <u>배송중</u> · <u>완료</u> · <u>취소</u> · <u>반품</u> 건수를 상태 박스로 표시</li>
                </ul>

                <!-- 비중 차트 -->
                <h3>8.4 비중 차트</h3>
                <ul class="list">
                    <li><b>결제수단 비중</b> : 도넛 차트(예: 카드, 가상계좌, 간편결제)</li>
                    <li><b>카테고리 비중</b> : 도넛 차트(카테고리별 비율)</li>
                </ul>

                <!-- 매출 추이 -->
                <h3>8.5 매출 추이</h3>
                <ul class="list">
                    <li><b>라인 차트</b> : 구간별 금액 추이</li>
                    <li><b>시리즈 전환</b> : <u>매출 / 실매출 / 환불</u> 버튼으로 데이터 교체</li>
                </ul>

                <!-- 상품 Top 5 -->
                <h3>8.6 상품 Top 5</h3>
                <ul class="list">
                    <li><b>테이블 열</b> : <u># · 상품명 · SKU · 수량 · 매출액</u></li>
                    <li><b>정렬 전환</b> : <u>수량</u> / <u>매출액</u> 버튼으로 Top 5 기준 변경</li>
                </ul>

                <!-- 한 줄 요약 -->
                <div class="note">
                    <b>요약</b> : ① 필터를 맞추고 ② KPI 카드로 규모를 파악한 뒤 ③ 상태·비중·추이·Top5를 통해
                    어떤 상품/카테고리·결제수단이 성과를 내는지 확인합니다.
                </div>
              </div>
            </details>
        </section>

        <!-- 9. 마이그레이션 -->
        <section class="card" id="sec-9">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 9) 마이그레이션 & 적용</summary>
              <div class="fold-body">

                <!-- 목적/범위 -->
                <div class="note">
                    본 섹션은 <b>퍼블리싱 완료된 13개 화면</b>을 실제 서비스에 <b>안전하게 연결</b>하고
                    메인/서브 관리자별 권한과 스토어 기능을 <b>순차 적용</b>하기 위한 체크리스트입니다.
                </div>

                <!-- 단계별 진행 -->
                <h3>9.1 단계별 진행(로드맵)</h3>
                <ul class="list">
                    <li><b>0단계 – 준비</b> : 현재 결제/주문/쿠폰/배송 정책 문구 통일, 공지 초안 준비</li>
                    <li><b>1단계 – 화면 연결</b> : 퍼블리싱 13페이지를 실제 데이터와 연결(관리자 01_01~01_07, 유저 02_01~02_04)</li>
                    <li><b>2단계 – 데이터 검증</b> : 테스트 주문/환불/쿠폰 적용 시나리오로 숫자·상태가 맞는지 확인</li>
                    <li><b>3단계 – 점진 오픈</b> : 내부 스태프 → 일부 서브 사이트 → 전체 서브 사이트 순으로 확장</li>
                    <li><b>4단계 – 안정화</b> : 오류/이탈 구간 점검(로그/통계), 정책 문구 재정비, 교육 자료 배포</li>
                </ul>

                <!-- 역할/권한 적용 -->
                <h3>9.2 권한·노출 적용</h3>
                <ul class="list">
                    <li><b>메인 관리자</b> : 모든 서브 관리자 사이트의 스토어 메뉴 노출/사용, 서브 관리자별 설정 조회·수정 가능</li>
                    <li><b>서브 관리자</b> : <u>메인 관리자가 스토어 사용 허용</u> 시에만 자신의 사이트에 스토어 메뉴 노출/사용</li>
                    <li><b>유저</b> : 해당 사이트가 스토어 활성일때 사이드 메뉴 노출</li>
                </ul>

                <!-- 화면 연결(퍼블리싱 → 서비스) -->
                <h3>9.3 화면 연결(퍼블리싱 → 실제 서비스)</h3>
                <ul class="list">
                    <li><b>관리자</b> : 01_01~01_07 (스토어 설정, 매출 통계, 카테고리/상품, 주문/결제, 장바구니 조회, 쿠폰 발행)</li>
                    <li><b>유저</b> : 02_01(리스트), 02_01_01(상세), 02_01_02(주문/결제), 02_02(장바구니), 02_03(주문/결제 내역), 02_04(쿠폰)</li>
                    <li><b>연결 원칙</b> : 화면은 동일하게 유지하고, 버튼/필드만 실제 데이터와 동작하도록 연결</li>
                </ul>

                <!-- 결제/정책 정리 -->
                <h3>9.4 결제·정책 정리</h3>
                <ul class="list">
                    <li><b>결제</b> : <u>단건 결제만</u> 지원(정기결제/구독 스케줄 전면 제외)</li>
                    <li><b>서브 관리자별 결제키</b> : 스토어 설정(01_01)에서 서브 관리자별 Toss 키 등록 → 각 서브 관리자의 결제 분리</li>
                    <li><b>정책 문구</b> : 무료배송 기준, 환불/배송 정책을 장바구니·주문/결제·주문내역에서 <u>동일 문구</u>로 노출</li>
                </ul>

                <!-- 데이터/모델 준비(개념) -->
                <h3>9.5 데이터 준비(개념적)</h3>
                <ul class="list">
                    <li><b>스토어 설정/토글</b> : 사이트별 스토어 활성 및 상점 기본 정보</li>
                    <li><b>결제 설정</b> : 서브 관리자별 Toss 키(테스트/라이브)</li>
                    <li><b>카테고리/상품</b> : 트리/정렬, 상품 상태/재고/이미지</li>
                    <li><b>주문/쿠폰/장바구니</b> : 주문 상태 흐름, 쿠폰 유형/조건, 방치 장바구니 정의</li>
                </ul>

                <!-- 테스트 시나리오 -->
                <h3>9.6 필수 테스트 시나리오</h3>
                <ul class="list">
                    <li><b>상품 → 장바구니 → 결제 성공</b> : 쿠폰 적용 포함</li>
                    <li><b>결제 실패 후 재시도</b> : 입력값 유지 및 재결제 동작 확인</li>
                    <li><b>환불/취소</b> : 주문 상태/금액 반영, 영수증/내역 노출 확인</li>
                    <li><b>서브 관리자별 결제키</b> : 서로 다른 서브 사이트 주문이 올바른 키로 결제되는지</li>
                    <li><b>정책 일관성</b> : 무료배송/환불/배송 문구가 모든 화면에서 동일</li>
                </ul>

                <!-- 운영 체크리스트 -->
                <h3>9.7 운영 체크리스트(출시 전·후)</h3>
                <ul class="list">
                    <li><b>출시 전</b> : 샘플 상품/쿠폰/주문 데이터로 대시보드(01_02) 수치 점검</li>
                    <li><b>출시 직후</b> : 실패 결제 급증, 방치 장바구니 증가 모니터링(8장 참고)</li>
                    <li><b>교육</b> : 서브 관리자용 <u>짧은 사용 가이드</u>(주문 처리, 쿠폰 발행, 통계 확인)</li>
                    <li><b>문의 대응</b> : 환불 소요 기간·배송 조회 위치 등 FAQ 정리</li>
                </ul>

                <!-- 최종 승인 기준 -->
                <h3>9.8 최종 승인(Go-Live) 기준</h3>
                <ul class="list">
                    <li>퍼블리싱 13페이지가 실제 데이터와 모두 연결되어 정상 동작</li>
                    <li>메인/서브 관리자 권한·노출 규칙이 요구사항대로 작동</li>
                    <li>서브 관리자별 결제키로 결제/환불이 정상 처리</li>
                    <li>정책 문구(무료배송·환불·배송)가 화면 간 불일치 없이 동일</li>
                    <li>테스트 시나리오 전 항목 <u>성공</u>, 초기 모니터링(24~48h)에서 치명 오류 없음</li>
                </ul>

                <!-- 한 줄 요약 -->
                <div class="note">
                    <b>요약</b> :
                    ① 화면을 실제 데이터와 연결 → ② 권한·정책을 일원화 → ③ 결제·주문 전 과정을 시나리오로 검증 →
                    ④ 점진 오픈 및 모니터링으로 안정화합니다.
                </div>
              </div>
            </details>
        </section>

        <!-- 10) 추가 작업 (관리자별 스토어 사용 허용 플로우) -->
        <section class="card" id="store-admin-todo">
            <details class="fold">
              <summary><i class="fa-solid fa-folder-minus"></i> 10) 추가 작업 - 관리자별 스토어 사용 허용</summary>
              <div class="fold-body">

                <!-- 10.1 -->
                <h3 style="margin-top:12px">10.1 메인 관리자: 서브 관리자별 스토어 사용 허용</h3>

                <!-- 순서 이미지: 001 → 002 -->
                <figure style="margin:0 0 12px">
                    <img src="img/001.png" alt="최고 관리자님 > 챗봇 설정 탭" style="max-width:100%;border:1px solid #e5e7eb;border-radius:12px" />
                </figure>
                <figure style="margin:0 0 12px">
                    <img src="img/002.png" alt="최고 관리자님 > 관리자 회원 관리 > (행 우측) 챗봇 버튼" style="max-width:100%;border:1px solid #e5e7eb;border-radius:12px" />
                </figure>

                <ul class="list">
                    <li><b>메인 관리자</b>가 <u>관리자 회원 관리</u>에서 특정 <b>서브 관리자</b>를 선택한 뒤 해당 계정의 <u>챗봇 설정</u> 화면에서
                        <b>"관리자별 사이트 스토어 기능 사용여부"</b>를 체크로 제어할 수 있도록 항목을 추가</li>
                </ul>
                <ul class="list">
                    <li>위 체크 항목을 <b>챗봇 설정</b> 탭에 신규 추가(체크 시 사용, 미체크 시 미사용)</li>
                    <li>체크 상태에 따라 해당 <b>서브 관리자의 사이트</b>에 스토어 메뉴 노출 및 관련 기능 접근을 허용/차단</li>
                    <li>기본값은 <b>미사용</b>으로 두고 <b>메인 관리자만</b> 변경 가능하도록 제한</li>
                </ul>
                <ul class="list">
                    <li><b>ac_manager_sites</b> 테이블에 <b>스토어 사용 여부</b>를 저장할 <b>새 컬럼</b>을 추가
                        (컬럼명/타입은 내부 규칙에 따르며 기본값은 미사용)</li>
                    <li>해당 값에 기반해 <u>사이드 메뉴 노출</u>, <u>페이지 접근 가드</u>, <u>결제·주문·쿠폰 등 스토어 기능</u> 접근을 공통 분기</li>
                </ul>

                <!-- 10.2 -->
                <h3 style="margin-top:16px">10.2 서브 관리자: 내 사이트 관리 &gt; 메인 설정 (푸터 정보)</h3>

                <figure style="margin:0 0 12px">
                    <img src="img/003.png" alt="서브 관리자 > 내 사이트 관리 > 메인 설정" style="max-width:100%;border:1px solid #e5e7eb;border-radius:12px" />
                </figure>
                <ul class="list">
                    <li>서브 관리자가 자신의 사이트 <b>푸터에 들어갈 정보</b>를 등록할 수 있도록 <b>입력 폼</b>을 추가
                        (예: 상호, 연락처, 사업자정보, 고지 문구 등)</li>
                    <li>해당 정보 저장을 위해 <b>ac_manager_sites</b> 테이블에 <b>푸터 관련 컬럼</b>을 추가</li>
                    <li>등록된 푸터 정보가 <b>개별 사이트에만</b> 노출되도록 <b>공용 푸터 렌더링 로직</b>을 수정</li>
                </ul>

                <!-- 10.3 -->
                <h3 style="margin-top:16px">10.3 서브 관리자: 내 사이트 관리 &gt; 메뉴 설정 (스토어 분류)</h3>

                <figure style="margin:0 0 12px">
                    <img src="img/004.png" alt="서브 관리자 > 내 사이트 관리 > 메뉴 설정" style="max-width:100%;border:1px solid #e5e7eb;border-radius:12px" />
                </figure>
                <ul class="list">
                    <li>서브 관리자가 <b>내 사이트 관리 &gt; 메뉴 설정</b>에서 메뉴를 추가할 때
                        <b>페이지 기능 타입</b> 목록에 <b>"스토어" 분류</b>를 추가
                        (리스트/상세/장바구니/주문/쿠폰 등 스토어 페이지 연결용)</li>
                    <li><b>승인된 서브 관리자</b>만 스토어 분류를 추가 및 사용할 수 있도록
                        <b>권한, 상태 체크</b>를 적용(관리자 승인 전에는 노출/선택 불가)</li>
                </ul>
              </div>
            </details>
        </section>
    </div>
    <script>
      // 모두 열기/접기: 0~10 섹션 범위 안의 모든 <details> 대상으로 동작
      (function () {
        // 대상 섹션 아이디(0~9 + 10=store-admin-todo)
        const sectionIds = [
          "sec-0","sec-1","sec-2","sec-3","sec-4",
          "sec-5","sec-6","sec-7","sec-8","sec-9","store-admin-todo"
        ];

        const sectionRoots = sectionIds
          .map(id => document.getElementById(id))
          .filter(Boolean);

        // 섹션들 안에 있는 모든 <details> 수집 (접기/펼치기 블록 전부)
        function allDetails() {
          return sectionRoots.flatMap(sec => Array.from(sec.querySelectorAll('details')));
        }

        function setAll(open) {
          allDetails().forEach(d => { d.open = open; });
        }

        // 버튼 바인딩
        const btnOpen  = document.getElementById('btnOpenAll');
        const btnClose = document.getElementById('btnCloseAll');

        if (btnOpen)  btnOpen.addEventListener('click',  () => setAll(true));
        if (btnClose) btnClose.addEventListener('click', () => setAll(false));
      })();
    </script>
</body>
</html>
