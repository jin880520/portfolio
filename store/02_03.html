<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>주문/결제 내역</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="css/navbar.css?v=val_251015_001">
    <link rel="stylesheet" href="test/test.css?v=val_251015_001">
    <link rel="stylesheet" href="css/member_store.css?v=val_251015_001">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        .layout{display:grid;grid-template-columns:1fr;gap:16px;align-items:start}
        .cb-sidemenu{width:250px;position:fixed;left:0;top:0;bottom:0;border-right:1px solid var(--cb-line);background:#fff}
        .filters{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
        .filters .seg{display:flex;gap:6px;flex-wrap:wrap}
        .filters .seg .btn{border-radius:999px;padding:8px 12px}
        .filters .grow{flex:1}
        .filters .inline{display:flex;gap:8px;align-items:center}
        .filters .right{margin-left:auto}
        .orders{display:grid;gap:12px}
        .order{border:1px solid var(--cb-line);border-radius:14px;overflow:hidden;background:#fff}
        .order-head{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--cb-line);background:#f9fbff}
        .order-id{font-weight:900}
        .order-meta{color:var(--cb-sub);font-size:12px}
        .status{display:flex;gap:6px;align-items:center}
        .badge.ok{background:#e9f7ef;color:#1e7e34;border:1px solid #d6f0de}
        .badge.warn{background:#fff6d8;color:#8a6d00;border:1px solid #ffecb3}
        .badge.danger{background:#ffecec;color:#b02a37;border:1px solid #ffd6d6}
        .badge.gray{background:#f1f5f9;color:#475569;border:1px solid #e2e8f0}
        .order-body{padding:12px}
        .items{display:grid;gap:10px}
        .item{display:grid;grid-template-columns:72px 1fr auto;gap:10px;align-items:center;border:1px solid var(--cb-line);border-radius:12px;padding:8px}
        .thumb{width:72px;height:72px;overflow:hidden;border-radius:10px;background:#fafafa;border:1px solid var(--cb-line)}
        .thumb img{width:100%;height:100%;object-fit:cover;display:block}
        .it-title{font-weight:800;font-size:14px;line-height:1.35;margin-bottom:4px}
        .it-meta{color:var(--cb-sub);font-size:12px}
        .it-price{text-align:right;font-weight:900}
        .order-foot{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;padding:12px;border-top:1px dashed var(--cb-line)}
        .sum{display:grid;gap:6px}
        .sum-line{display:flex;justify-content:space-between;align-items:center;font-size:14px}
        .sum-total{display:flex;justify-content:space-between;align-items:center;font-weight:900;font-size:16px}
        .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
        .actions .btn{min-width:110px}
        .empty{padding:30px;text-align:center;color:#6c7a89}
        .collapse-btn{display:inline-flex;gap:6px;align-items:center}
        .order-body.collapsed{display:none}
        .pager{display:flex;gap:8px;justify-content:center;align-items:center}
        .pager .btn.small[disabled]{opacity:.4;cursor:not-allowed}
        @media (max-width:480px){.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.actions .btn{min-width:0;width:100%;justify-content:center}.actions .btn .label{display:none}}
    </style>
</head>
<body>
<aside class="cb-sidemenu"><!--개발시 해당 메뉴는 기존 메뉴를 사용하세요 {% include 'admin/navbar.html' %} -->
    <div class="cb-sidemenu-inner cb-menu-style">
        <div class="cb-menu-admin-logo" style="text-align:center;margin-bottom:12px;"><img src="test/testai.png" alt="사이트 로고" style="max-width:150px;object-fit:contain;"></div>
        <div class="cb-menu-admin-name">테스트 유저님<br></div>
        <a><span class="cb-menu-icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></span>로그아웃</a>
        <div class="cb-menu-toggle-all" style="display:flex;gap:15px;justify-content:flex-end;padding:12px;">
            <a type="button" onclick="expandAllMenus()" class="toggle_all" id="expandAllBtn_p">＋</a>
            <a type="button" onclick="collapseAllMenus()" class="toggle_all" id="collapseAllBtn_p">－</a>
        </div>
        <div class="cb-menu-group" data-key="menu_general">
            <div class="cb-menu-group-title" onclick="toggleMenuGroup(this)">스토어</div>
            <div class="cb-menu-group-body">
                <a href="02_01.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-cart-shopping"></i></span>쇼핑</a>
                <a href="02_02.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-basket-shopping"></i></span>장바구니</a>
                <a href="02_03.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-file-invoice-dollar"></i></span>주문/결제 내역</a>
                <a href="02_04.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-ticket"></i></span>쿠폰</a>
            </div>
        </div>
        <a>&nbsp;</a>
    </div>
</aside>
<div class="wrap">
    <div class="title">주문/결제 내역</div>
    <div class="sub">최근 주문을 확인하고 배송상태, 영수증/취소/환불 요청을 진행할 수 있어요. 모든 결제는 <b>토스페이</b>로 처리됩니다.</div>
    <div class="layout">
        <div class="card filters">
            <div class="seg">
                <button class="btn small" data-q="7d">최근 7일</button>
                <button class="btn small" data-q="1m">1개월</button>
                <button class="btn small" data-q="3m">3개월</button>
                <button class="btn small" data-q="all">전체</button>
            </div>
            <div class="inline">
                <input type="date" id="fromDate" class="box">
                <span>~</span>
                <input type="date" id="toDate" class="box">
            </div>
            <select id="statusSel" class="box">
                <option value="">상태 전체</option>
                <option value="결제완료">결제완료</option>
                <option value="상품준비중">상품준비중</option>
                <option value="배송중">배송중</option>
                <option value="배송완료">배송완료</option>
                <option value="취소">취소</option>
                <option value="환불완료">환불완료</option>
            </select>
            <div class="grow"></div>
            <div class="inline">
                <input type="text" id="q" class="box" placeholder="주문번호/상품명 검색">
                <button class="btn small" id="btnSearch"><i class="fa-solid fa-magnifying-glass"></i><span class="label"> 검색</span></button>
            </div>
        </div>
        <div class="orders" id="orders"></div>
        <div class="pager">
            <button class="btn small" id="prevPage"><i class="fa-solid fa-chevron-left"></i><span class="label"> 이전</span></button>
            <div class="hint"><span id="pageInfo">1 / 1</span></div>
            <button class="btn small" id="nextPage"><span class="label">다음 </span><i class="fa-solid fa-chevron-right"></i></button>
        </div>
    </div>
</div>
<script>
    const fmtKRW = n => (n ?? 0).toLocaleString("ko-KR") + "원";
    const parseDate = s => new Date(s + "T00:00:00");

    const ordersData = [
        { id: "20251010-001234", date: "2025-10-10", status: "결제완료", payMethod: "토스페이", receiver: "홍길동", total: 159000 + 3000 - 0, discount: 3000, shipping: 0, items: [{ title: "무선 이어폰 X1", sku: "WX1-BLK", opt: "블랙/기본", qty: 1, price: 129000, img: "https://picsum.photos/seed/o1/200/200" }] },
        { id: "20251005-000845", date: "2025-10-05", status: "배송중", payMethod: "토스페이", receiver: "홍길동", total: 15000 + 3000, discount: 0, shipping: 3000, items: [{ title: "실리콘 케이스", sku: "CASE-XS", opt: "네이비", qty: 1, price: 15000, img: "https://picsum.photos/seed/o2/200/200" }] },
        { id: "20250926-000421", date: "2025-09-26", status: "배송완료", payMethod: "토스페이", receiver: "홍길동", total: 24000, discount: 0, shipping: 0, items: [{ title: "USB-C 케이블 1m", sku: "USBC-1M", opt: "화이트/1m", qty: 2, price: 12000, img: "https://picsum.photos/seed/o3/200/200" }] },
        { id: "20250920-000212", date: "2025-09-20", status: "취소", payMethod: "토스페이", receiver: "홍길동", total: 39000, discount: 0, shipping: 0, items: [{ title: "이어팁 세트", sku: "TIP-S", opt: "S/M/L", qty: 1, price: 39000, img: "https://picsum.photos/seed/o4/200/200" }] },
        { id: "20250912-000111", date: "2025-09-12", status: "환불완료", payMethod: "토스페이", receiver: "홍길동", total: 29000, discount: 0, shipping: 0, items: [{ title: "충전 아답터 20W", sku: "PD-20W", opt: "화이트", qty: 1, price: 29000, img: "https://picsum.photos/seed/o5/200/200" }] }
    ];

    function badgeClass(st) {
        if (st === "결제완료" || st === "상품준비중") return "warn";
        if (st === "배송중" || st === "배송완료") return "ok";
        if (st === "취소" || st === "환불완료") return "danger";
        return "gray";
    }

    const elOrders = document.getElementById("orders");
    const elPageInfo = document.getElementById("pageInfo");
    const PAGE_SIZE = 3;
    let page = 1;

    function applyFilters() {
        const status = document.getElementById("statusSel").value;
        const q = document.getElementById("q").value.trim().toLowerCase();
        const fd = document.getElementById("fromDate").value;
        const td = document.getElementById("toDate").value;
        return ordersData.filter(o => {
            if (status && o.status !== status) return false;
            if (fd && parseDate(o.date) < parseDate(fd)) return false;
            if (td && parseDate(o.date) > parseDate(td)) return false;
            if (q) {
                const hay = [o.id, o.receiver, o.payMethod, ...o.items.map(i => i.title)].join(" ").toLowerCase();
                if (!hay.includes(q)) return false;
            }
            return true;
        });
    }

    function render() {
        const list = applyFilters();
        const totalPages = Math.max(1, Math.ceil(list.length / PAGE_SIZE));
        page = Math.min(page, totalPages);
        const start = (page - 1) * PAGE_SIZE;
        const slice = list.slice(start, start + PAGE_SIZE);

        elOrders.innerHTML = "";
        if (slice.length === 0) {
            elOrders.innerHTML = '<div class="empty">표시할 주문이 없습니다. 기간/상태/검색어를 조정해 보세요.</div>';
        }

        slice.forEach(o => {
            const wrap = document.createElement("div");
            wrap.className = "order";

            const head = document.createElement("div");
            head.className = "order-head";
            head.innerHTML =
                `<div><div class="order-id">주문번호 ${o.id}</div><div class="order-meta">${o.date} · 수령인 ${o.receiver} · ${o.payMethod}</div></div>` +
                `<div class="status"><span class="badge ${badgeClass(o.status)}">${o.status}</span><button class="btn small ghost collapse-btn"><i class="fa-solid fa-chevron-down"></i><span class="label"> 상세</span></button></div>`;

            const body = document.createElement("div");
            body.className = "order-body";

            const items = document.createElement("div");
            items.className = "items";
            o.items.forEach(it => {
                const row = document.createElement("div");
                row.className = "item";
                row.innerHTML =
                    `<div class="thumb"><img src="${it.img}" alt=""></div>` +
                    `<div><div class="it-title">${it.title}</div><div class="it-meta">SKU: ${it.sku} · 옵션: ${it.opt} · 수량: ${it.qty}</div></div>` +
                    `<div class="it-price">${fmtKRW(it.price * it.qty)}</div>`;
                items.appendChild(row);
            });

            const foot = document.createElement("div");
            foot.className = "order-foot";
            foot.innerHTML =
                `<div class="sum">` +
                `<div class="sum-line"><span>상품금액</span><span>${fmtKRW(o.items.reduce((s, i) => s + i.price * i.qty, 0))}</span></div>` +
                `<div class="sum-line"><span>할인금액</span><span>-${fmtKRW(o.discount || 0)}</span></div>` +
                `<div class="sum-line"><span>배송비</span><span>${fmtKRW(o.shipping || 0)}</span></div>` +
                `<div class="sum-total"><span>결제금액</span><span>${fmtKRW(o.total)}</span></div>` +
                `</div>` +
                `<div class="actions">` +
                `<button class="btn small" data-act="receipt" data-id="${o.id}"><i class="fa-regular fa-file-lines"></i><span class="label"> 영수증</span></button>` +
                `${o.status === "결제완료" || o.status === "상품준비중" ? `<button class="btn small danger" data-act="cancel" data-id="${o.id}"><i class="fa-regular fa-circle-xmark"></i><span class="label"> 주문취소</span></button>` : ""}` +
                `${o.status === "배송완료" ? `<button class="btn small" data-act="return" data-id="${o.id}"><i class="fa-solid fa-rotate-left"></i><span class="label"> 반품신청</span></button>` : ""}` +
                `${o.status === "배송중" || o.status === "배송완료" ? `<button class="btn small" data-act="track" data-id="${o.id}"><i class="fa-solid fa-truck"></i><span class="label"> 배송조회</span></button>` : ""}` +
                `</div>`;

            body.appendChild(items);
            wrap.appendChild(head);
            wrap.appendChild(body);
            wrap.appendChild(foot);
            elOrders.appendChild(wrap);

            const toggleBtn = head.querySelector(".collapse-btn");
            let collapsed = false;
            toggleBtn.onclick = () => {
                collapsed = !collapsed;
                body.classList.toggle("collapsed", collapsed);
                toggleBtn.innerHTML = collapsed ? '<i class="fa-solid fa-chevron-right"></i><span class="label"> 열기</span>' : '<i class="fa-solid fa-chevron-down"></i><span class="label"> 상세</span>';
            };
        });

        elPageInfo.textContent = `${page} / ${totalPages}`;
        document.getElementById("prevPage").disabled = page <= 1;
        document.getElementById("nextPage").disabled = page >= totalPages;

        elOrders.querySelectorAll("[data-act]").forEach(btn => {
            btn.onclick = e => {
                const act = e.currentTarget.dataset.act;
                const id = e.currentTarget.dataset.id;
                if (act === "receipt") alert(`주문 ${id}의 토스페이 영수증(데모)을 확인합니다.`);
                if (act === "cancel") { if (confirm(`주문 ${id}을(를) 취소하시겠어요?`)) alert("취소 접수가 완료되었습니다. (데모)"); }
                if (act === "return") alert(`주문 ${id} 반품 신청 화면으로 이동합니다. (데모)`);
                if (act === "track") alert(`주문 ${id} 배송 조회로 이동합니다. (데모)`);
            };
        });
    }

    document.querySelectorAll(".filters .seg .btn").forEach(b => {
        b.onclick = () => {
            const now = new Date();
            const to = now.toISOString().slice(0, 10);
            let from;
            const q = b.dataset.q;
            if (q === "7d") { const d = new Date(now); d.setDate(d.getDate() - 6); from = d.toISOString().slice(0, 10); }
            else if (q === "1m") { const d = new Date(now); d.setMonth(d.getMonth() - 1); from = d.toISOString().slice(0, 10); }
            else if (q === "3m") { const d = new Date(now); d.setMonth(d.getMonth() - 3); from = d.toISOString().slice(0, 10); }
            else { from = ""; }
            document.getElementById("fromDate").value = from || "";
            document.getElementById("toDate").value = from ? to : "";
            page = 1;
            render();
        };
    });

    document.getElementById("btnSearch").onclick = () => { page = 1; render(); };
    document.getElementById("statusSel").onchange = () => { page = 1; render(); };
    document.getElementById("fromDate").onchange = () => { page = 1; render(); };
    document.getElementById("toDate").onchange = () => { page = 1; render(); };
    document.getElementById("prevPage").onclick = () => { if (page > 1) { page--; render(); } };
    document.getElementById("nextPage").onclick = () => { page++; render(); };

    render();
</script>
</body>
</html>
