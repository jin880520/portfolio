<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>주문/결제</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="css/navbar.css?v=val_251015_001">
    <link rel="stylesheet" href="test/test.css?v=val_251015_001">
    <link rel="stylesheet" href="css/member_store.css?v=val_251015_001">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        .box,select,textarea,input[type="number"],input[type="text"],input[type="tel"],input[type="email"]{width:100%}
        .layout{display:grid;grid-template-columns:1fr 380px;gap:16px;align-items:start}
        @media (max-width:1000px){.layout{grid-template-columns:1fr}}
        .section-title{font-weight:900;margin:4px 0 10px}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .form-row{display:grid;gap:8px}
        @media (max-width:720px){.form-grid{grid-template-columns:1fr}}
        .addr-grid{display:grid;grid-template-columns:1fr auto;gap:8px}
        .radio-row{display:flex;gap:10px;flex-wrap:wrap}
        .order-items{display:grid;gap:10px}
        .order-item{display:grid;grid-template-columns:72px 1fr auto;gap:10px;align-items:center;border:1px solid var(--cb-line);border-radius:12px;padding:8px}
        .thumb{width:72px;height:72px;overflow:hidden;border-radius:10px;background:#fafafa;border:1px solid var(--cb-line)}
        .thumb img{width:100%;height:100%;object-fit:cover;display:block}
        .oi-title{font-weight:800;font-size:14px;line-height:1.35;margin-bottom:4px}
        .oi-meta{color:var(--cb-sub);font-size:12px}
        .price-box{text-align:right}
        .price-now{font-weight:900}
        .divider{height:1px;background:var(--cb-line);margin:10px 0}
        .sum-line{display:flex;justify-content:space-between;align-items:center;margin:8px 0;font-size:15px}
        .sum-line .val{font-weight:800}
        .sum-total{display:flex;justify-content:space-between;align-items:center;margin-top:10px;padding-top:10px;border-top:1px dashed var(--cb-line);font-size:18px;font-weight:900}
        .summary .btn{width:100%}
        .terms{display:flex;gap:8px;align-items:flex-start;margin-top:10px}
        .note{background:#f8fafc;border:1px solid var(--cb-line);border-radius:12px;padding:10px;font-size:13px;color:#2a3952}
        .coupon-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
        .buybar{display:none}
        @media (max-width:900px){.buybar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--cb-line);box-shadow:0 -6px 16px rgba(51,65,85,.06);display:flex;gap:10px;padding:10px 12px;align-items:center;z-index:50}.buybar .price{font-weight:900;font-size:16px;margin-right:auto}body{padding-bottom:90px}}
    </style>
</head>
<body>
<aside class="cb-sidemenu"><!--개발시 해당 메뉴는 기존 메뉴를 사용하세요 {% include 'admin/navbar.html' %} -->
    <div class="cb-sidemenu-inner cb-menu-style">
        <div class="cb-menu-admin-logo" style="text-align:center;margin-bottom:12px;"><img src="test/testai.png" alt="사이트 로고" style="max-width:150px;object-fit:contain;"></div>
        <div class="cb-menu-admin-name">테스트 유저님<br></div>
        <a><span class="cb-menu-icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></span>로그아웃</a>
        <div class="cb-menu-toggle-all" style="display:flex;gap:15px;justify-content:flex-end;padding:12px;">
            <a type="button" onclick="expandAllMenus()" class="toggle_all" id="expandAllBtn_p">＋</a>
            <a type="button" onclick="collapseAllMenus()" class="toggle_all" id="collapseAllBtn_p">－</a>
        </div>
        <div class="cb-menu-group" data-key="menu_general">
            <div class="cb-menu-group-title" onclick="toggleMenuGroup(this)">스토어</div>
            <div class="cb-menu-group-body">
                <a href="02_01.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-cart-shopping"></i></span>쇼핑</a>
                <a href="02_02.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-basket-shopping"></i></span>장바구니</a>
                <a href="02_03.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-file-invoice-dollar"></i></span>주문/결제 내역</a>
                <a href="02_04.html" class="cb-sidemenu-link"><span class="cb-menu-icon"><i class="fa-solid fa-ticket"></i></span>쿠폰</a>
            </div>
        </div>
        <a>&nbsp;</a>
    </div>
</aside>
<div class="wrap">
    <div class="title">주문/결제</div>
    <div class="sub">주문 정보를 확인하고 결제 방법을 선택해 주세요. 500,000원 이상 결제 시 기본 배송비(3,000원)가 무료입니다.</div>
    <div class="layout">
        <div class="stack">
            <div class="card">
                <div class="section-title"><i class="fa-regular fa-user"></i> 주문자 정보</div>
                <div class="form-grid">
                    <div class="form-row">
                        <label>이름</label>
                        <input type="text" id="buyer_name" class="box" placeholder="홍길동" value="테스트 유저">
                    </div>
                    <div class="form-row">
                        <label>이메일</label>
                        <input type="email" id="buyer_email" class="box" placeholder="you@example.com" value="demo@example.com">
                    </div>
                    <div class="form-row">
                        <label>휴대폰</label>
                        <input type="tel" id="buyer_phone" class="box" placeholder="010-0000-0000" value="010-1111-2222">
                    </div>
                    <div class="form-row">
                        <label>요청사항</label>
                        <input type="text" id="order_memo" class="box" placeholder="배송 시 요청사항(선택)">
                    </div>
                </div>
            </div>
            <div class="card" style="margin-top: 12px;">
                <div class="section-title"><i class="fa-solid fa-truck"></i> 배송지 정보</div>
                <div class="form-grid">
                    <div class="form-row">
                        <label>수령인</label>
                        <input type="text" id="recv_name" class="box" placeholder="수령인 이름" value="테스트 유저">
                    </div>
                    <div class="form-row">
                        <label>연락처</label>
                        <input type="tel" id="recv_phone" class="box" placeholder="010-0000-0000" value="010-1111-2222">
                    </div>
                    <div class="form-row" style="grid-column:1/-1">
                        <label>주소</label>
                        <div class="addr-grid">
                            <input type="text" id="addr1" class="box" placeholder="기본 주소" value="서울시 어디구 어디로 123">
                            <button class="btn small" type="button" id="btnFindAddr"><i class="fa-solid fa-magnifying-glass-location"></i> 주소검색</button>
                        </div>
                        <input type="text" id="addr2" class="box" placeholder="상세 주소" style="margin-top:8px" value="101동 1001호">
                    </div>
                    <div class="form-row">
                        <label>배송 요청사항</label>
                        <select id="ship_req" class="box">
                            <option value="">선택 안 함</option>
                            <option>문 앞에 놔주세요</option>
                            <option>경비실에 맡겨주세요</option>
                            <option>연락 후 배송</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>수령 장소</label>
                        <select id="ship_place" class="box">
                            <option>자택</option>
                            <option>회사</option>
                            <option>기타</option>
                        </select>
                    </div>
                </div>
                <div class="note" style="margin-top:10px"><i class="fa-regular fa-circle-check"></i> 결제 완료 후 배송 정보 변경은 고객센터로 문의해 주세요.</div>
            </div>
        </div>
        <div class="card summary">
            <div class="section-title"><i class="fa-solid fa-list-check"></i> 주문 상품</div>
            <div class="order-items" id="orderItems"></div>
            <div class="divider"></div>
            <div class="coupon-row">
                <i class="fa-solid fa-ticket"></i>
                <select id="coupon" class="box">
                    <option value="">쿠폰 선택</option>
                    <option value="3000">3,000원 할인</option>
                    <option value="10p">10% 할인(최대 10,000원)</option>
                </select>
                <button class="btn small" id="applyCoupon">적용</button>
            </div>
            <div class="divider"></div>
            <div class="sum-line"><span>상품금액</span><span class="val" id="sumSubtotal">0원</span></div>
            <div class="sum-line"><span>할인금액</span><span class="val" id="sumDiscount">0원</span></div>
            <div class="sum-line"><span>배송비</span><span class="val" id="sumShip">0원</span></div>
            <div class="sum-total"><span>결제예정금액</span><span id="sumTotal">0원</span></div>
            <button class="btn primary" style="margin-top:12px" id="btnPay"><i class="fa-solid fa-lock"></i> 결제하기</button>
            <div class="hint" style="margin-top:8px"><i class="fa-regular fa-clock"></i> 결제 완료 후 주문 번호가 발급됩니다.</div>
        </div>
    </div>
</div>
<div class="buybar" id="buybar">
    <div class="price" id="barPrice">0원</div>
    <button class="btn primary" id="barPay"><i class="fa-solid fa-lock"></i> 결제</button>
</div>
<script>
    const SHIPPING_BASE = 3000, SHIPPING_FREE_MIN = 30000;
    const fmtKRW = n => (n ?? 0).toLocaleString("ko-KR") + "원";
    let cart = [];
    try {
        const saved = localStorage.getItem("demo_cart");
        cart = saved ? JSON.parse(saved) : [];
    } catch (e) {
        cart = [];
    }
    if (!Array.isArray(cart) || cart.length === 0) {
        cart = [
            { id: 1, title: "무선 이어폰 X1", sku: "WX1-BLK", color: "블랙", pack: "기본", price: 159000, sale: 129000, qty: 1, img: "https://picsum.photos/seed/c101/300/300" },
            { id: 2, title: "실리콘 케이스", sku: "CASE-XS", color: "네이비", pack: "-", price: 19000, sale: 15000, qty: 2, img: "https://picsum.photos/seed/c102/300/300" }
        ];
    }
    const elItems = document.getElementById("orderItems");
    const elSumSubtotal = document.getElementById("sumSubtotal");
    const elSumDiscount = document.getElementById("sumDiscount");
    const elSumShip = document.getElementById("sumShip");
    const elSumTotal = document.getElementById("sumTotal");
    const elBarPrice = document.getElementById("barPrice");
    function lineOrigin(it) { return (it.price || 0) * (it.qty || 1); }
    function linePrice(it) { const base = it.sale && it.sale < it.price ? it.sale : it.price; return (base || 0) * (it.qty || 1); }
    function renderItems() {
        elItems.innerHTML = "";
        cart.forEach(it => {
            const line = linePrice(it);
            const row = document.createElement("div");
            row.className = "order-item";
            row.innerHTML =
                `<div class="thumb"><img src="${it.img}" alt=""></div>` +
                `<div><div class="oi-title">${it.title}</div><div class="oi-meta">SKU: ${it.sku} · 색상: ${it.color} · 구성: ${it.pack} · 수량: ${it.qty}</div></div>` +
                `<div class="price-box"><div class="price-now">${fmtKRW(line)}</div></div>`;
            elItems.appendChild(row);
        });
    }
    function calcSummary() {
        const subtotal = cart.reduce((s, x) => s + lineOrigin(x), 0);
        const afterSale = cart.reduce((s, x) => s + linePrice(x), 0);
        let discount = subtotal - afterSale;
        const applied = document.getElementById("coupon").dataset.applied || "";
        if (applied === "3000") discount += 3000;
        if (applied === "10p") discount += Math.min(Math.floor(afterSale * 0.10), 10000);
        const pay = Math.max(afterSale - discount, 0);
        const shipping = pay > 0 && pay < SHIPPING_FREE_MIN ? SHIPPING_BASE : 0;
        const total = pay + shipping;
        elSumSubtotal.textContent = fmtKRW(subtotal);
        elSumDiscount.textContent = "-" + fmtKRW(discount);
        elSumShip.textContent = fmtKRW(shipping);
        elSumTotal.textContent = fmtKRW(total);
        elBarPrice.textContent = fmtKRW(total);
    }
    function applyCoupon() {
        const val = document.getElementById("coupon").value;
        document.getElementById("coupon").dataset.applied = val || "";
        calcSummary();
    }
    document.getElementById("applyCoupon").onclick = applyCoupon;
    function isAgreed() { return document.getElementById("agreeAll")?.checked; }
    function currentPayMethod() { const el = document.querySelector('input[name="pay"]:checked'); return el ? el.value : "card"; }
    function validateForm() {
        const buyer_name = document.getElementById("buyer_name").value.trim();
        const buyer_phone = document.getElementById("buyer_phone").value.trim();
        const buyer_email = document.getElementById("buyer_email").value.trim();
        const recv_name = document.getElementById("recv_name").value.trim();
        const recv_phone = document.getElementById("recv_phone").value.trim();
        const addr1 = document.getElementById("addr1").value.trim();
        if (!buyer_name || !buyer_phone || !buyer_email || !recv_name || !recv_phone || !addr1) { alert("주문자/배송 정보를 모두 입력해 주세요."); return false; }
        if (!isAgreed()) { alert("약관에 동의해 주세요."); return false; }
        return true;
    }
    function requestPay() {
        if (!validateForm()) return;
        const method = currentPayMethod();
        const payload = {
            method,
            buyer: { name: document.getElementById("buyer_name").value.trim(), phone: document.getElementById("buyer_phone").value.trim(), email: document.getElementById("buyer_email").value.trim() },
            shipping: { name: document.getElementById("recv_name").value.trim(), phone: document.getElementById("recv_phone").value.trim(), addr1: document.getElementById("addr1").value.trim(), addr2: document.getElementById("addr2").value.trim(), req: document.getElementById("ship_req").value, place: document.getElementById("ship_place").value },
            coupon: document.getElementById("coupon").dataset.applied || "",
            items: cart.map(i => ({ id: i.id, qty: i.qty, price: i.price, sale: i.sale })),
            amount: elSumTotal.textContent
        };
        alert("결제 모듈 호출(데모)\n" + JSON.stringify(payload, null, 2));
    }
    document.getElementById("btnPay").onclick = requestPay;
    document.getElementById("barPay").onclick = requestPay;
    document.getElementById("btnFindAddr").onclick = () => alert("주소 검색 모듈을 연동해 주세요. (데모)");
    renderItems();
    calcSummary();
</script>
</body>
</html>
